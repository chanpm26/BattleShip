(()=>{"use strict";function e(e,t){for(let n=0;n<e.gameBoard.board.length;n++){let a=document.createElement("div");a.classList.add("gameSquare"),a.classList.add(e.playerName),a.setAttribute("data-id",n),t.appendChild(a)}}function t(){location.reload()}function n(e){document.getElementById("message").textContent=e}const a=()=>{let e=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],t=[],n=[],a=0;return{board:e,sunkShips:a,successfulAttacks:n,missedAttacks:t,placeShip:function(t,n,a){let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const r=e=>(e=parseInt(e),!!n.includes(e)&&(a.push(e),!0)),i=function(e){return t==a.length?(e=!0,this.sunkStatus=e,e):(e=!1,this.sunkStatus=e,e)};return{nameOfShip:e,length:t,coordinates:n,whereHit:a,sunkStatus:arguments.length>4&&void 0!==arguments[4]&&arguments[4],hit:r,isSunk:i}}(t,n,a);a.forEach((t=>{e[t].push(r)}))},receiveAttack:function(r){if(""!=e[r]){n.push(r);let t=e[r][0].hit(r),i=e[r][0].isSunk();return 1==i&&(a+=1),{attackStatus:t,shipStatus:i}}return t.push(r),!1},report:function(){return e.map((e=>{if(""!=e)return e[0].isSunk(),1==e[0].sunkStatus})).includes(!1)?"There are still alive ships":"All ships have sunk!"}}},r=function(e,t){return{playerName:e,sendAttack:function(e,t){let n="valid";return(e.missedAttacks.includes(t)||null!=e.successfulAttacks&&e.successfulAttacks.includes(t))&&(n="notValid"),"valid"==n?e.receiveAttack(t):"notvalid"},gameBoard:a()}};function i(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}const o=Array.from(document.getElementsByClassName("draggable"));function s(e){e.preventDefault()}function d(e){e.target.style.backgroundColor="aqua"}function l(e){e.target.style.backgroundColor=null}function c(e){e.dataTransfer.setData("text",e.target.getAttribute("id"))}function u(e){e.preventDefault();let t=e.dataTransfer.getData("text"),n=e.target;l(e),n.appendChild(document.querySelector(`[id="${t}"]`))}function m(){let e=Array.from(document.getElementsByClassName("droppable")).filter((e=>{if(e.hasChildNodes())return e}));return{boxID:e.map((e=>e.getAttribute("set-id"))),shipID:e.map((e=>e.firstChild.id))}}function h(e,t){return t=Number(t),"carrier"==e?[t,t+1,t+2,t+3,t+4]:"battleship"==e?[t,t+1,t+2,t+3]:"cruiser"==e||"submarine"==e?[t,t+1,t+2]:"destroyer"==e?[t,t+1]:void 0}let p=r("playerOne");beginButton.addEventListener("click",(function(){let e=m(),t=function(e,t){return{shipOne:h(t[0],e[0]),shipTwo:h(t[1],e[1]),shipThree:h(t[2],e[2]),shipFour:h(t[3],e[3]),shipFive:h(t[4],e[4])}}(e.boxID,e.shipID);p.gameBoard.placeShip("carrier",t.shipOne.length,t.shipOne),p.gameBoard.placeShip("battleship",t.shipTwo.length,t.shipTwo),p.gameBoard.placeShip("submarine",t.shipThree.length,t.shipThree),p.gameBoard.placeShip("cruiser",t.shipFour.length,t.shipFour),p.gameBoard.placeShip("destroyer",t.shipFive.length,t.shipFive)}));let g=function(){let e=i(0,2).toString()+i(0,5).toString();e=Number(e);let t=[e,e+1,e+2,e+3,e+4],n=i(3,4).toString()+i(0,6).toString();n=Number(n);let a=[n,n+1,n+2,n+3],r=i(7,8).toString()+i(0,7).toString();r=Number(r);let o=[r,r+1,r+2],s="9"+i(0,7).toString();s=Number(s);let d=[s,s+1,s+2],l=i(5,6).toString()+i(0,7).toString();return l=Number(l),{firstShipCoordinates:t,secondShipCoordinates:a,thirdShipCoordinates:o,fourthShipCoordinates:d,fifthShipCoordinates:[l,l+1]}}(),f=r("playerTwo");f.gameBoard.placeShip("carrier",5,g.firstShipCoordinates),f.gameBoard.placeShip("battleship",4,g.secondShipCoordinates),f.gameBoard.placeShip("submarine",3,g.thirdShipCoordinates),f.gameBoard.placeShip("cruiser",3,g.fourthShipCoordinates),f.gameBoard.placeShip("destroyer",2,g.fifthShipCoordinates),console.log(f.gameBoard.board);let S="";function v(e,t,n){e==p?(t.style.pointerEvents="none",n.style.pointerEvents="auto"):e==f&&(n.style.pointerEvents="none",t.style.pointerEvents="auto")}function y(e,t,a,r){let i=e.sendAttack(t.gameBoard,r);return"notvalid"==i?(e==p&&n("That move is not valid. Please pick another tile."),"notvalid"):(1==i.attackStatus?(a.style.backgroundColor="green",n("")):0==i&&(a.style.backgroundColor="red",n("")),1==i.shipStatus&&n("A ship becomes feast for the fishes!"),S=function(e){return"All ships have sunk!"==e.gameBoard.report()}(t),i)}let E="";function B(e,n,a){if(v(e,n,a),Array.from(document.getElementsByClassName("gameSquare")).forEach((r=>{r.addEventListener("click",(function(){let i=r.getAttribute("data-id");e==p&&("notvalid"!=y(e,f,r,i)&&(v(e=f,n,a),B(e,n,a)),1==S&&function(e){document.getElementById("mainContainer").classList.add("hidden");const n=document.getElementById("gameOverContainer");n.classList.remove("hidden");let a=document.createElement("h1");a.innerText=`The game is over. ${e} has won!`,n.appendChild(a);const r=document.createElement("button");r.textContent="Start New Game",r.classList.add("newgame"),r.onclick=t,n.appendChild(r)}(e==p?"Computer":playerOneName.textContent))}))})),e==f)if(""!=E){let t=E+1,r=document.querySelector(`[data-id="${t}"]`);setTimeout((()=>{let o=y(e,p,r,t);for(;"notvalid"==o;){let t=i(0,99),n=document.querySelector(`[data-id="${t}"]`);o=y(e,p,n,t)}"notvalid"!=o&&(v(e=p,n,a),E=1==o.attackStatus&&0==o.shipStatus?t:"")}),700)}else{let t=i(0,99),r=document.querySelector(`[data-id="${t}"]`);setTimeout((()=>{let o=y(e,p,r,t);for(;"notvalid"==o;){let t=i(0,99),n=document.querySelector(`[data-id="${t}"]`);o=y(e,p,n,t)}"notvalid"!=o&&(v(e=p,n,a),E=1==o.attackStatus&&0==o.shipStatus?t:"")}),700)}}const b=document.getElementById("boardOne"),C=document.getElementById("boardTwo"),k=document.getElementById("prepareButton"),L=document.getElementById("beginButton"),A=document.getElementById("playerOneName"),I=document.getElementById("newGameButton");let N=document.getElementById("playerName"),T=p,w="";N.addEventListener("input",(function(){w=N.value})),k.addEventListener("click",(function(){document.getElementById("welcomeScreenContainer").classList.add("hidden"),document.getElementById("selectScreenContainer").classList.remove("hidden"),function(){const e=document.getElementById("selectBoard");for(let t=0;t<100;t++){let n=document.createElement("div");n.classList.add("selectSquare"),n.classList.add("droppable"),n.setAttribute("set-id",t),e.appendChild(n)}}(),o.forEach((e=>{e.addEventListener("dragstart",c)})),Array.from(document.getElementsByClassName("droppable")).forEach((e=>{e.addEventListener("dragover",s),e.addEventListener("dragover",d),e.addEventListener("dragleave",l),e.addEventListener("drop",u)})),Array.from(document.getElementsByClassName("droppable")).forEach((e=>{e.addEventListener("drop",(function(){5==m().boxID.length&&document.getElementById("beginButton").classList.remove("hidden")}))}))})),L.addEventListener("click",(function(){document.getElementById("selectScreenContainer").classList.add("hidden"),document.getElementById("mainContainer").classList.remove("hidden"),function(e,t){e.textContent=""!=t?t:"Anonymous Challenger"}(A,w),e(p,b),e(f,C)})),L.addEventListener("click",(function(){B(T,b,C)})),I.onclick=t})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yeUZ1bmN0aW9ucy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NvbXB1dGVyY29vcmRpbmF0ZXMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9kcmFnYW5kZHJvcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVsb2dpYy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHNob3dTZWxlY3Rpb25TY3JlZW4oKSB7XG4gIGNvbnN0IHdlbGNvbWVTY3JlZW5Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICBcIndlbGNvbWVTY3JlZW5Db250YWluZXJcIlxuICApO1xuICB3ZWxjb21lU2NyZWVuQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gIGNvbnN0IHNlbGVjdFNjcmVlbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgIFwic2VsZWN0U2NyZWVuQ29udGFpbmVyXCJcbiAgKTtcbiAgc2VsZWN0U2NyZWVuQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG59XG5cbmZ1bmN0aW9uIHNob3dTZWxlY3RCb2FyZCgpIHtcbiAgY29uc3Qgc2VsZWN0Qm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlbGVjdEJvYXJkXCIpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgbGV0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdFNxdWFyZScpO1xuICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdkcm9wcGFibGUnKTtcbiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic2V0LWlkXCIsIGkpO1xuICAgIHNlbGVjdEJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2hvd0dhbWVCb2FyZCgpIHtcbiAgY29uc3Qgc2VsZWN0U2NyZWVuQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgXCJzZWxlY3RTY3JlZW5Db250YWluZXJcIlxuICApO1xuICBzZWxlY3RTY3JlZW5Db250YWluZXIuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgY29uc3QgbWFpbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpbkNvbnRhaW5lclwiKTtcbiAgbWFpbkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVHYW1lQm9hcmQocGxheWVyLCBib2FyZCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHBsYXllci5nYW1lQm9hcmQuYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgZ2FtZVNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZ2FtZVNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiZ2FtZVNxdWFyZVwiKTtcbiAgICBnYW1lU3F1YXJlLmNsYXNzTGlzdC5hZGQocGxheWVyLnBsYXllck5hbWUpO1xuICAgIGdhbWVTcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBpKTtcbiAgICBib2FyZC5hcHBlbmRDaGlsZChnYW1lU3F1YXJlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRQbGF5ZXJOYW1lKHBsYXllciwgcGxheWVyTmFtZSkge1xuICBpZiAocGxheWVyTmFtZSAhPSBcIlwiKSB7XG4gICAgcGxheWVyLnRleHRDb250ZW50ID0gcGxheWVyTmFtZTtcbiAgfSBlbHNlIHtcbiAgICBwbGF5ZXIudGV4dENvbnRlbnQgPSBcIkFub255bW91cyBDaGFsbGVuZ2VyXCI7XG4gIH1cbn1cblxuZnVuY3Rpb24gbmV3R2FtZSgpIHtcbiAgbG9jYXRpb24ucmVsb2FkKCk7XG59XG5cbmZ1bmN0aW9uIHNob3dHYW1lT3ZlcihjdXJyZW50UGxheWVyKSB7XG4gIGNvbnN0IG1haW5Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1haW5Db250YWluZXJcIik7XG4gIG1haW5Db250YWluZXIuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgY29uc3QgZ2FtZU92ZXJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVPdmVyQ29udGFpbmVyXCIpO1xuICBnYW1lT3ZlckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKVxuICBsZXQgZGlzcGxheVdpbm5lclRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDFcIik7XG4gIGRpc3BsYXlXaW5uZXJUZXh0LmlubmVyVGV4dCA9IGBUaGUgZ2FtZSBpcyBvdmVyLiAke2N1cnJlbnRQbGF5ZXJ9IGhhcyB3b24hYDtcbiAgZ2FtZU92ZXJDb250YWluZXIuYXBwZW5kQ2hpbGQoZGlzcGxheVdpbm5lclRleHQpO1xuICBjb25zdCBuZXdHYW1lQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgbmV3R2FtZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3RhcnQgTmV3IEdhbWVcIjtcbiAgbmV3R2FtZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibmV3Z2FtZVwiKTtcbiAgbmV3R2FtZUJ1dHRvbi5vbmNsaWNrID0gbmV3R2FtZTtcbiAgZ2FtZU92ZXJDb250YWluZXIuYXBwZW5kQ2hpbGQobmV3R2FtZUJ1dHRvbik7XG59XG5cbmZ1bmN0aW9uIHNob3dNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgY29uc3QgbWVzc2FnZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVzc2FnZVwiKTtcbiAgbWVzc2FnZUNvbnRhaW5lci50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG59XG5cbmV4cG9ydCB7XG4gIGNyZWF0ZUdhbWVCb2FyZCxcbiAgc2hvd1NlbGVjdGlvblNjcmVlbixcbiAgc2hvd1NlbGVjdEJvYXJkLFxuICBzaG93R2FtZUJvYXJkLFxuICBhZGRQbGF5ZXJOYW1lLFxuICBuZXdHYW1lLFxuICBzaG93R2FtZU92ZXIsXG4gIHNob3dNZXNzYWdlLFxufTtcbiIsImNvbnN0IHNoaXBGYWN0b3J5ID0gKFxuICBuYW1lT2ZTaGlwLFxuICBsZW5ndGgsXG4gIGNvb3JkaW5hdGVzID0gW10sXG4gIHdoZXJlSGl0ID0gW10sXG4gIHN1bmtTdGF0dXMgPSBmYWxzZVxuKSA9PiB7XG4gIGNvbnN0IGhpdCA9IChudW1iZXIpID0+IHtcbiAgICBudW1iZXIgPSBwYXJzZUludChudW1iZXIpXG4gICBpZiAoY29vcmRpbmF0ZXMuaW5jbHVkZXMobnVtYmVyKSkge1xuICAgICAgICB3aGVyZUhpdC5wdXNoKG51bWJlcik7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICB9O1xuICBjb25zdCBpc1N1bmsgPSBmdW5jdGlvbiAoc3Vua1N0YXR1cykge1xuICAgIGlmIChsZW5ndGggPT0gd2hlcmVIaXQubGVuZ3RoKSB7XG4gICAgICBzdW5rU3RhdHVzID0gdHJ1ZTtcbiAgICAgIHRoaXMuc3Vua1N0YXR1cyA9IHN1bmtTdGF0dXNcbiAgICAgIHJldHVybiBzdW5rU3RhdHVzO1xuICAgIH0gZWxzZSB7XG4gICAgc3Vua1N0YXR1cyA9IGZhbHNlO1xuICAgIHRoaXMuc3Vua1N0YXR1cyA9IHN1bmtTdGF0dXNcbiAgICByZXR1cm4gc3Vua1N0YXR1cztcbiAgfX07XG4gIHJldHVybiB7IG5hbWVPZlNoaXAsIGxlbmd0aCwgY29vcmRpbmF0ZXMsIHdoZXJlSGl0LCBzdW5rU3RhdHVzLCBoaXQsIGlzU3VuayB9O1xufTtcblxuXG4vL2dhbWVCb2FyZCBpcyAxMHgxMFxuXG5jb25zdCBnYW1lQm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICBsZXQgYm9hcmQgPSBbXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW11cbiAgXVxuICBsZXQgbWlzc2VkQXR0YWNrcyA9IFtdXG4gIGxldCBzdWNjZXNzZnVsQXR0YWNrcyA9IFtdXG4gIGxldCBzdW5rU2hpcHMgPSAwXG4gIGNvbnN0IHBsYWNlU2hpcCA9IGZ1bmN0aW9uIChuYW1lT2ZTaGlwLCBsZW5ndGgsIGNvb3JkaW5hdGVzKSB7XG4gICAgbGV0IG5ld1NoaXAgPSBzaGlwRmFjdG9yeShuYW1lT2ZTaGlwLCBsZW5ndGgsIGNvb3JkaW5hdGVzKTtcbiAgICBjb29yZGluYXRlcy5mb3JFYWNoKGNvb3JkaW5hdGUgPT4ge1xuICAgICAgYm9hcmRbY29vcmRpbmF0ZV0ucHVzaChuZXdTaGlwKVxuICAgIH0pXG4gICAgfVxuICA7XG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSBmdW5jdGlvbihudW1iZXIpIHtcbiAgICBpZiAoYm9hcmRbbnVtYmVyXSAhPSBcIlwiKSB7XG4gICAgICBzdWNjZXNzZnVsQXR0YWNrcy5wdXNoKG51bWJlcik7XG4gICAgICBsZXQgYXR0YWNrU3RhdHVzID0gYm9hcmRbbnVtYmVyXVswXS5oaXQobnVtYmVyKTtcbiAgICAgIGxldCBzaGlwU3RhdHVzID0gYm9hcmRbbnVtYmVyXVswXS5pc1N1bmsoKVxuICAgICAgaWYgKHNoaXBTdGF0dXMgPT0gdHJ1ZSkge1xuICAgICAgICBzdW5rU2hpcHMgKz0gMVxuICAgICAgfVxuICAgICAgcmV0dXJuIHthdHRhY2tTdGF0dXMsIHNoaXBTdGF0dXN9XG4gICAgfSBlbHNlIHsgICAgICBcbiAgICAgIG1pc3NlZEF0dGFja3MucHVzaChudW1iZXIpO1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSBcbiAgfTtcbiAgY29uc3QgcmVwb3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgbGV0IGNoZWNrU3RhdHVzID0gYm9hcmQubWFwKCh0aWxlKSA9PiB7XG4gICAgICBpZiAodGlsZSAhPSAnJykge1xuICAgICAgICB0aWxlWzBdLmlzU3VuaygpXG4gICAgICBpZiAodGlsZVswXS5zdW5rU3RhdHVzID09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgICBpZiAoY2hlY2tTdGF0dXMuaW5jbHVkZXMoZmFsc2UpKSB7XG4gICAgICByZXR1cm4gXCJUaGVyZSBhcmUgc3RpbGwgYWxpdmUgc2hpcHNcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwiQWxsIHNoaXBzIGhhdmUgc3VuayFcIjtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHsgYm9hcmQsIHN1bmtTaGlwcywgc3VjY2Vzc2Z1bEF0dGFja3MsIG1pc3NlZEF0dGFja3MsIHBsYWNlU2hpcCwgcmVjZWl2ZUF0dGFjaywgcmVwb3J0IH07XG59O1xuXG4vL3BsYXllciBGYWN0b3J5XG5cblxuY29uc3QgcGxheWVyRmFjdG9yeSA9IGZ1bmN0aW9uKHBsYXllck5hbWUsIHBsYXllclR5cGUpIHtcbiAgY29uc3QgZ2FtZUJvYXJkID0gZ2FtZUJvYXJkRmFjdG9yeSgpOyAgIFxuICAgIGNvbnN0IHNlbmRBdHRhY2sgPSBmdW5jdGlvbihib2FyZCwgY29vcmRpbmF0ZSkge1xuICAgICAgbGV0IGF0dGFja1N0YXR1cyA9ICd2YWxpZCdcbiAgICAgIGlmIChib2FyZC5taXNzZWRBdHRhY2tzLmluY2x1ZGVzKGNvb3JkaW5hdGUpKSB7XG4gICAgICAgICAgYXR0YWNrU3RhdHVzID0gJ25vdFZhbGlkJ1xuICAgICAgICB9IGVsc2UgaWYgKGJvYXJkLnN1Y2Nlc3NmdWxBdHRhY2tzICE9IHVuZGVmaW5lZCAmJiBib2FyZC5zdWNjZXNzZnVsQXR0YWNrcy5pbmNsdWRlcyhjb29yZGluYXRlKSkge1xuICAgICAgICAgIGF0dGFja1N0YXR1cyA9ICdub3RWYWxpZCdcbiAgICAgICB9XG4gICAgICAgaWYgKGF0dGFja1N0YXR1cyA9PSAndmFsaWQnKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpXG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ25vdHZhbGlkJ1xuICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtwbGF5ZXJOYW1lLCBzZW5kQXR0YWNrLCBnYW1lQm9hcmR9XG59XG5cbmV4cG9ydCB7IGdhbWVCb2FyZEZhY3RvcnksIHBsYXllckZhY3RvcnksIHNoaXBGYWN0b3J5IH07XG4iLCJmdW5jdGlvbiBnZXRSYW5kb21Db29yZGluYXRlcyhtaW4sIG1heCkge1xuICBtaW4gPSBNYXRoLmNlaWwobWluKTtcbiAgbWF4ID0gTWF0aC5mbG9vcihtYXgpO1xuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDb21wdXRlckNvb3JkaW5hdGVzKCkge1xuICBsZXQgZmlyc3RTaGlwRmlyc3ROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCAyKS50b1N0cmluZygpO1xuICBsZXQgZmlyc3RTaGlwU2Vjb25kTnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoMCwgNSkudG9TdHJpbmcoKTtcbiAgbGV0IGZpcnN0U2hpcEZpcnN0UG9zaXRpb24gPSBmaXJzdFNoaXBGaXJzdE51bWJlciArIGZpcnN0U2hpcFNlY29uZE51bWJlcjtcbiAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiA9IE51bWJlcihmaXJzdFNoaXBGaXJzdFBvc2l0aW9uKTtcbiAgbGV0IGZpcnN0U2hpcENvb3JkaW5hdGVzID0gW1xuICAgIGZpcnN0U2hpcEZpcnN0UG9zaXRpb24sXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDEsXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDIsXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDMsXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDQsXG4gIF07XG4gIGxldCBzZWNvbmRTaGlwRmlyc3ROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcygzLCA0KS50b1N0cmluZygpO1xuICBsZXQgc2Vjb25kU2hpcFNlY29uZE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDYpLnRvU3RyaW5nKCk7XG4gIGxldCBzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiA9IHNlY29uZFNoaXBGaXJzdE51bWJlciArIHNlY29uZFNoaXBTZWNvbmROdW1iZXI7XG4gIHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uID0gTnVtYmVyKHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uKTtcbiAgbGV0IHNlY29uZFNoaXBDb29yZGluYXRlcyA9IFtcbiAgICBzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbixcbiAgICBzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiArIDEsXG4gICAgc2Vjb25kU2hpcEZpcnN0UG9zaXRpb24gKyAyLFxuICAgIHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uICsgMyxcbiAgXTtcbiAgbGV0IHRoaXJkU2hpcEZpcnN0TnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoNywgOCkudG9TdHJpbmcoKTtcbiAgbGV0IHRoaXJkU2hpcFNlY29uZE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDcpLnRvU3RyaW5nKCk7XG4gIGxldCB0aGlyZFNoaXBGaXJzdFBvc2l0aW9uID0gdGhpcmRTaGlwRmlyc3ROdW1iZXIgKyB0aGlyZFNoaXBTZWNvbmROdW1iZXI7XG4gIHRoaXJkU2hpcEZpcnN0UG9zaXRpb24gPSBOdW1iZXIodGhpcmRTaGlwRmlyc3RQb3NpdGlvbik7XG4gIGxldCB0aGlyZFNoaXBDb29yZGluYXRlcyA9IFtcbiAgICB0aGlyZFNoaXBGaXJzdFBvc2l0aW9uLFxuICAgIHRoaXJkU2hpcEZpcnN0UG9zaXRpb24gKyAxLFxuICAgIHRoaXJkU2hpcEZpcnN0UG9zaXRpb24gKyAyLFxuICBdO1xuICBsZXQgZm91cnRoU2hpcEZpcnN0TnVtYmVyID0gXCI5XCJcbiAgbGV0IGZvdXJ0aFNoaXBTZWNvbmROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCA3KS50b1N0cmluZygpO1xuICBsZXQgZm91cnRoU2hpcEZpcnN0UG9zaXRpb24gPSBmb3VydGhTaGlwRmlyc3ROdW1iZXIgKyBmb3VydGhTaGlwU2Vjb25kTnVtYmVyO1xuICBmb3VydGhTaGlwRmlyc3RQb3NpdGlvbiA9IE51bWJlcihmb3VydGhTaGlwRmlyc3RQb3NpdGlvbik7XG4gIGxldCBmb3VydGhTaGlwQ29vcmRpbmF0ZXMgPSBbXG4gICAgZm91cnRoU2hpcEZpcnN0UG9zaXRpb24sXG4gICAgZm91cnRoU2hpcEZpcnN0UG9zaXRpb24gKyAxLFxuICAgIGZvdXJ0aFNoaXBGaXJzdFBvc2l0aW9uICsgMixcbiAgXTtcbiAgbGV0IGZpZnRoU2hpcEZpcnN0TnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoNSwgNikudG9TdHJpbmcoKTtcbiAgbGV0IGZpZnRoU2hpcFNlY29uZE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDcpLnRvU3RyaW5nKCk7XG4gIGxldCBmaWZ0aFNoaXBGaXJzdFBvc2l0aW9uID0gZmlmdGhTaGlwRmlyc3ROdW1iZXIgKyBmaWZ0aFNoaXBTZWNvbmROdW1iZXI7XG4gIGZpZnRoU2hpcEZpcnN0UG9zaXRpb24gPSBOdW1iZXIoZmlmdGhTaGlwRmlyc3RQb3NpdGlvbik7XG4gIGxldCBmaWZ0aFNoaXBDb29yZGluYXRlcyA9IFtmaWZ0aFNoaXBGaXJzdFBvc2l0aW9uLCBmaWZ0aFNoaXBGaXJzdFBvc2l0aW9uICsgMV07XG4gIHJldHVybiB7Zmlyc3RTaGlwQ29vcmRpbmF0ZXMsIHNlY29uZFNoaXBDb29yZGluYXRlcywgdGhpcmRTaGlwQ29vcmRpbmF0ZXMsIGZvdXJ0aFNoaXBDb29yZGluYXRlcywgZmlmdGhTaGlwQ29vcmRpbmF0ZXN9XG59XG5cbmV4cG9ydCB7Z2V0UmFuZG9tQ29vcmRpbmF0ZXMsIGNyZWF0ZUNvbXB1dGVyQ29vcmRpbmF0ZXN9XG4iLCJjb25zdCBkcmFnZ2FibGVTaGlwcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZHJhZ2dhYmxlJykpIFxuXG5mdW5jdGlvbiBhY3RpdmF0ZURyb3AoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuXG5mdW5jdGlvbiBzaG93SG92ZXJDb2xvcihldmVudCkge1xuICAgIGV2ZW50LnRhcmdldC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnYXF1YSdcbn1cblxuZnVuY3Rpb24gcmVtb3ZlSG92ZXJDb2xvcihldmVudCl7XG4gICAgZXZlbnQudGFyZ2V0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IG51bGxcbn1cblxuZnVuY3Rpb24gZHJhZyhlKSB7XG4gICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YSgndGV4dCcsIGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKSlcbn1cblxuZnVuY3Rpb24gZHJvcChlKXtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgbGV0IGRhdGEgPSBlLmRhdGFUcmFuc2Zlci5nZXREYXRhKCd0ZXh0JylcbiAgICBsZXQgdGFyZ2V0ID0gZS50YXJnZXRcbiAgICByZW1vdmVIb3ZlckNvbG9yKGUpXG4gICB0YXJnZXQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2lkPVwiJHtkYXRhfVwiXWApKVxufVxuXG5cbmxldCBhbGxvd0RyYWcgPSBmdW5jdGlvbigpIHtcbiAgICBkcmFnZ2FibGVTaGlwcy5mb3JFYWNoKHNoaXAgPT4ge1xuICAgIHNoaXAuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZHJhZylcbn0pXG59XG5cbmxldCBhbGxvd0Ryb3AgPSBmdW5jdGlvbigpIHtcbiAgICBjb25zdCBzZWxlY3RCb3hlcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZHJvcHBhYmxlJykpXG4gICAgc2VsZWN0Qm94ZXMuZm9yRWFjaChib3ggPT4ge1xuICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIGFjdGl2YXRlRHJvcClcbiAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCBzaG93SG92ZXJDb2xvcilcbiAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgcmVtb3ZlSG92ZXJDb2xvcilcbiAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGRyb3ApXG59KVxufVxuXG5mdW5jdGlvbiBnZXRQb3NpdGlvbnMoKXtcbiAgICBjb25zdCBzZWxlY3RCb3hlcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZHJvcHBhYmxlJykpXG4gICAgbGV0IGJveGVzV2l0aFNoaXBzID0gc2VsZWN0Qm94ZXMuZmlsdGVyKGJveCA9PiB7XG4gICAgICAgIGlmIChib3guaGFzQ2hpbGROb2RlcygpKSB7XG4gICAgICAgICAgICByZXR1cm4gYm94XG4gICAgICAgIH1cbiAgICB9KVxuICAgIGxldCBib3hJRCA9IGJveGVzV2l0aFNoaXBzLm1hcChib3ggPT4gYm94LmdldEF0dHJpYnV0ZSgnc2V0LWlkJykpXG4gICAgbGV0IHNoaXBJRCA9IGJveGVzV2l0aFNoaXBzLm1hcChib3ggPT4gYm94LmZpcnN0Q2hpbGQuaWQpXG4gICAgcmV0dXJuIHtib3hJRCwgc2hpcElEfVxufVxuXG5mdW5jdGlvbiBjaGVja1Bvc2l0aW9ucygpIHtcbiAgICBjb25zdCBzZWxlY3RCb3hlcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZHJvcHBhYmxlJykpXG4gICAgc2VsZWN0Qm94ZXMuZm9yRWFjaChib3ggPT4ge1xuICAgICAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IGNoZWNrID0gZ2V0UG9zaXRpb25zKClcbiAgICAgICAgICAgIGlmIChjaGVjay5ib3hJRC5sZW5ndGggPT0gNSl7XG4gICAgICAgICAgICAgICAgY29uc3QgYmVnaW5CdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJlZ2luQnV0dG9uXCIpO1xuICAgICAgICAgICAgICAgIGJlZ2luQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpXG4gICAgICAgICAgICB9IFxuICAgICAgICB9KVxufSlcbn1cblxuZnVuY3Rpb24gY3JlYXRlU2hpcENvb3JkaW5hdGVzKHNoaXAsIGJveCkge1xuICAgIGJveCA9IE51bWJlcihib3gpXG4gICAgaWYgKHNoaXAgPT0gJ2NhcnJpZXInKSB7XG4gICAgICAgIGxldCBjb29yZGluYXRlcyA9IFtib3gsIGJveCsxLCBib3grMiwgYm94KzMsIGJveCs0XVxuICAgICAgICByZXR1cm4gY29vcmRpbmF0ZXNcbiAgICB9XG4gICAgaWYgKHNoaXAgPT0gJ2JhdHRsZXNoaXAnKSB7XG4gICAgbGV0IGNvb3JkaW5hdGVzID0gW2JveCwgYm94KzEsIGJveCsyLCBib3grM11cbiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzXG4gICAgfVxuICAgIGlmIChzaGlwID09ICdjcnVpc2VyJyB8fCBzaGlwID09ICdzdWJtYXJpbmUnKSB7XG4gICAgICAgIGxldCBjb29yZGluYXRlcyA9IFtib3gsIGJveCsxLCBib3grMl1cbiAgICAgICAgICAgIHJldHVybiBjb29yZGluYXRlc1xuICAgIH1cbiAgICBpZiAoc2hpcCA9PSAnZGVzdHJveWVyJykge1xuICAgICAgICAgICAgbGV0IGNvb3JkaW5hdGVzID0gW2JveCwgYm94KzFdXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzXG4gICAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVTaGlwcyhib3hlcywgc2hpcHMpIHtcbiAgICBsZXQgc2hpcE9uZSA9IGNyZWF0ZVNoaXBDb29yZGluYXRlcyhzaGlwc1swXSwgYm94ZXNbMF0pXG4gICAgbGV0IHNoaXBUd28gPSBjcmVhdGVTaGlwQ29vcmRpbmF0ZXMoc2hpcHNbMV0sIGJveGVzWzFdKVxuICAgIGxldCBzaGlwVGhyZWUgPSBjcmVhdGVTaGlwQ29vcmRpbmF0ZXMoc2hpcHNbMl0sIGJveGVzWzJdKVxuICAgIGxldCBzaGlwRm91ciA9IGNyZWF0ZVNoaXBDb29yZGluYXRlcyhzaGlwc1szXSwgYm94ZXNbM10pXG4gICAgbGV0IHNoaXBGaXZlID0gY3JlYXRlU2hpcENvb3JkaW5hdGVzKHNoaXBzWzRdLCBib3hlc1s0XSlcbiAgICByZXR1cm4ge3NoaXBPbmUsIHNoaXBUd28sIHNoaXBUaHJlZSwgc2hpcEZvdXIsIHNoaXBGaXZlfVxufVxuXG5leHBvcnQge2FsbG93RHJhZywgYWxsb3dEcm9wLCBnZXRQb3NpdGlvbnMsIGNoZWNrUG9zaXRpb25zLCBjcmVhdGVTaGlwc30iLCJpbXBvcnQgeyBwbGF5ZXJGYWN0b3J5IH0gZnJvbSBcIi4vZmFjdG9yeUZ1bmN0aW9uc1wiO1xuaW1wb3J0IHsgc2hvd01lc3NhZ2UsIHNob3dHYW1lT3ZlciB9IGZyb20gXCIuL2RvbVwiO1xuaW1wb3J0IHsgZ2V0UmFuZG9tQ29vcmRpbmF0ZXMsIGNyZWF0ZUNvbXB1dGVyQ29vcmRpbmF0ZXMgfSBmcm9tICcuL2NvbXB1dGVyY29vcmRpbmF0ZXMnXG5pbXBvcnQgeyBnZXRQb3NpdGlvbnMsIGNyZWF0ZVNoaXBzIH0gZnJvbSAnLi9kcmFnYW5kZHJvcCdcblxubGV0IHBsYXllck9uZSA9IHBsYXllckZhY3RvcnkoXCJwbGF5ZXJPbmVcIiwgXCJwZXJzb25cIik7XG5cblxuYmVnaW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpe1xuICBsZXQgcG9zaXRpb25zID0gZ2V0UG9zaXRpb25zKClcbiAgbGV0IHNoaXBzID0gY3JlYXRlU2hpcHMocG9zaXRpb25zLmJveElELCBwb3NpdGlvbnMuc2hpcElEKVxuICBwbGF5ZXJPbmUuZ2FtZUJvYXJkLnBsYWNlU2hpcChcImNhcnJpZXJcIiwgc2hpcHMuc2hpcE9uZS5sZW5ndGgsIHNoaXBzLnNoaXBPbmUpO1xuICBwbGF5ZXJPbmUuZ2FtZUJvYXJkLnBsYWNlU2hpcChcImJhdHRsZXNoaXBcIiwgc2hpcHMuc2hpcFR3by5sZW5ndGgsIHNoaXBzLnNoaXBUd28pO1xuICBwbGF5ZXJPbmUuZ2FtZUJvYXJkLnBsYWNlU2hpcChcInN1Ym1hcmluZVwiLCBzaGlwcy5zaGlwVGhyZWUubGVuZ3RoLCBzaGlwcy5zaGlwVGhyZWUpO1xuICBwbGF5ZXJPbmUuZ2FtZUJvYXJkLnBsYWNlU2hpcChcImNydWlzZXJcIiwgc2hpcHMuc2hpcEZvdXIubGVuZ3RoLCBzaGlwcy5zaGlwRm91cik7XG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwiZGVzdHJveWVyXCIsIHNoaXBzLnNoaXBGaXZlLmxlbmd0aCwgc2hpcHMuc2hpcEZpdmUpO1xufSlcblxuXG5sZXQgY29tcHV0ZXJDb29yZGluYXRlcyA9IGNyZWF0ZUNvbXB1dGVyQ29vcmRpbmF0ZXMoKVxubGV0IHBsYXllclR3byA9IHBsYXllckZhY3RvcnkoXCJwbGF5ZXJUd29cIiwgXCJDb21wdXRlclwiKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY2FycmllclwiLCA1LCBjb21wdXRlckNvb3JkaW5hdGVzLmZpcnN0U2hpcENvb3JkaW5hdGVzKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwiYmF0dGxlc2hpcFwiLCA0LCBjb21wdXRlckNvb3JkaW5hdGVzLnNlY29uZFNoaXBDb29yZGluYXRlcyk7XG5wbGF5ZXJUd28uZ2FtZUJvYXJkLnBsYWNlU2hpcChcInN1Ym1hcmluZVwiLCAzLCBjb21wdXRlckNvb3JkaW5hdGVzLnRoaXJkU2hpcENvb3JkaW5hdGVzKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY3J1aXNlclwiLCAzLCBjb21wdXRlckNvb3JkaW5hdGVzLmZvdXJ0aFNoaXBDb29yZGluYXRlcyk7XG5wbGF5ZXJUd28uZ2FtZUJvYXJkLnBsYWNlU2hpcChcImRlc3Ryb3llclwiLCAyLCBjb21wdXRlckNvb3JkaW5hdGVzLmZpZnRoU2hpcENvb3JkaW5hdGVzKTtcbmNvbnNvbGUubG9nKHBsYXllclR3by5nYW1lQm9hcmQuYm9hcmQpXG5cbmxldCBnYW1lU3RhdHVzID0gXCJcIjtcblxuZnVuY3Rpb24gZGlzYWJsZVNlbGZDbGlja3MoY3VycmVudFBsYXllciwgYm9hcmRPbmUsIGJvYXJkVHdvKSB7XG4gIGlmIChjdXJyZW50UGxheWVyID09IHBsYXllck9uZSkge1xuICAgIGJvYXJkT25lLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgICBib2FyZFR3by5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJhdXRvXCI7XG4gIH0gZWxzZSBpZiAoY3VycmVudFBsYXllciA9PSBwbGF5ZXJUd28pIHtcbiAgICBib2FyZFR3by5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgYm9hcmRPbmUuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiYXV0b1wiO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdhbWVPdmVyKG9wcG9zaW5nUGxheWVyKSB7XG4gIGxldCByZXBvcnQgPSBvcHBvc2luZ1BsYXllci5nYW1lQm9hcmQucmVwb3J0KCk7XG4gIGlmIChyZXBvcnQgPT0gXCJBbGwgc2hpcHMgaGF2ZSBzdW5rIVwiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNoZWNrR2FtZVN0YXR1cyhnYW1lU3RhdHVzKSB7XG4gIHJldHVybiBnYW1lU3RhdHVzO1xufVxuXG5cbmZ1bmN0aW9uIHBsYXlHYW1lSGVscGVyKGN1cnJlbnRQbGF5ZXIsIG9wcG9zaW5nUGxheWVyLCB0aWxlLCBzcXVhcmUpIHtcbiAgbGV0IGF0dGFjayA9IGN1cnJlbnRQbGF5ZXIuc2VuZEF0dGFjayhvcHBvc2luZ1BsYXllci5nYW1lQm9hcmQsIHNxdWFyZSk7XG4gIGlmIChhdHRhY2sgPT0gXCJub3R2YWxpZFwiKSB7XG4gICAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyT25lKSB7XG4gICAgc2hvd01lc3NhZ2UoXCJUaGF0IG1vdmUgaXMgbm90IHZhbGlkLiBQbGVhc2UgcGljayBhbm90aGVyIHRpbGUuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gXCJub3R2YWxpZFwiO1xuICB9XG4gIGlmIChhdHRhY2suYXR0YWNrU3RhdHVzID09IHRydWUpIHtcbiAgICB0aWxlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JlZW5cIjtcbiAgICBzaG93TWVzc2FnZShcIlwiKTtcbiAgfSBlbHNlIGlmIChhdHRhY2sgPT0gZmFsc2UpIHtcbiAgICB0aWxlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgc2hvd01lc3NhZ2UoXCJcIik7XG4gIH1cbiAgaWYgKGF0dGFjay5zaGlwU3RhdHVzID09IHRydWUpIHtcbiAgICBzaG93TWVzc2FnZShcIkEgc2hpcCBiZWNvbWVzIGZlYXN0IGZvciB0aGUgZmlzaGVzIVwiKTtcbiAgfVxuICBnYW1lU3RhdHVzID0gZ2FtZU92ZXIob3Bwb3NpbmdQbGF5ZXIpO1xuICByZXR1cm4gYXR0YWNrXG59XG5cbmxldCBsYXN0Q29tcHV0ZXJNb3ZlID0gJydcblxuZnVuY3Rpb24gcGxheUdhbWUoY3VycmVudFBsYXllciwgYm9hcmRPbmUsIGJvYXJkVHdvKSB7XG4gIGRpc2FibGVTZWxmQ2xpY2tzKGN1cnJlbnRQbGF5ZXIsIGJvYXJkT25lLCBib2FyZFR3byk7XG4gIGxldCBjb29yZGluYXRlcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImdhbWVTcXVhcmVcIikpO1xuICBjb29yZGluYXRlcy5mb3JFYWNoKCh0aWxlKSA9PiB7XG4gICAgdGlsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNxdWFyZSA9IHRpbGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcbiAgICAgIGlmIChjdXJyZW50UGxheWVyID09IHBsYXllck9uZSkge1xuICAgICAgICBsZXQgbW92ZSA9IHBsYXlHYW1lSGVscGVyKGN1cnJlbnRQbGF5ZXIsIHBsYXllclR3bywgdGlsZSwgc3F1YXJlKTtcbiAgICAgICAgaWYgKG1vdmUgIT0gXCJub3R2YWxpZFwiKSB7XG4gICAgICAgICAgY3VycmVudFBsYXllciA9IHBsYXllclR3bztcbiAgICAgICAgICBkaXNhYmxlU2VsZkNsaWNrcyhjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pO1xuICAgICAgICAgIHBsYXlHYW1lKGN1cnJlbnRQbGF5ZXIsIGJvYXJkT25lLCBib2FyZFR3byk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrR2FtZVN0YXR1cyhnYW1lU3RhdHVzKSA9PSB0cnVlKSB7XG4gICAgICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyT25lKSB7XG4gICAgICAgICAgICBzaG93R2FtZU92ZXIoXCJDb21wdXRlclwiKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2hvd0dhbWVPdmVyKHBsYXllck9uZU5hbWUudGV4dENvbnRlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyVHdvKSB7XG4gICAgaWYgKGxhc3RDb21wdXRlck1vdmUgIT0gJycpIHtcbiAgICAgIGxldCBuZWlnaGJvclNxdWFyZSA9IGxhc3RDb21wdXRlck1vdmUgKyAxXG4gICAgICBsZXQgdGlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWlkPVwiJHtuZWlnaGJvclNxdWFyZX1cIl1gKVxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBsZXQgbW92ZSA9IHBsYXlHYW1lSGVscGVyKGN1cnJlbnRQbGF5ZXIsIHBsYXllck9uZSwgdGlsZSwgbmVpZ2hib3JTcXVhcmUpXG4gICAgICB3aGlsZSAobW92ZSA9PSAnbm90dmFsaWQnKSB7XG4gICAgICAgIGxldCByYW5kb21TcXVhcmUgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCA5OSk7XG4gICAgICAgIGxldCByYW5kb21UaWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtaWQ9XCIke3JhbmRvbVNxdWFyZX1cIl1gKTtcbiAgICAgICAgbW92ZSA9IHBsYXlHYW1lSGVscGVyKFxuICAgICAgICAgIGN1cnJlbnRQbGF5ZXIsXG4gICAgICAgICAgcGxheWVyT25lLFxuICAgICAgICAgIHJhbmRvbVRpbGUsXG4gICAgICAgICAgcmFuZG9tU3F1YXJlKVxuICAgICAgfVxuICAgICAgaWYgKG1vdmUgIT0gXCJub3R2YWxpZFwiKSB7XG4gICAgICAgIGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXJPbmU7XG4gICAgICAgIGRpc2FibGVTZWxmQ2xpY2tzKGN1cnJlbnRQbGF5ZXIsIGJvYXJkT25lLCBib2FyZFR3byk7XG4gICAgICAgIGlmIChtb3ZlLmF0dGFja1N0YXR1cyA9PSB0cnVlICYmIG1vdmUuc2hpcFN0YXR1cyA9PSBmYWxzZSkge1xuICAgICAgICAgIGxhc3RDb21wdXRlck1vdmUgPSBuZWlnaGJvclNxdWFyZVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxhc3RDb21wdXRlck1vdmUgPSAnJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgNzAwKTtcbiAgICB9IGVsc2Uge1xuICAgIGxldCByYW5kb21TcXVhcmUgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCA5OSk7XG4gICAgbGV0IHJhbmRvbVRpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1pZD1cIiR7cmFuZG9tU3F1YXJlfVwiXWApO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgbGV0IG1vdmUgPSBwbGF5R2FtZUhlbHBlcihcbiAgICAgICAgY3VycmVudFBsYXllcixcbiAgICAgICAgcGxheWVyT25lLFxuICAgICAgICByYW5kb21UaWxlLFxuICAgICAgICByYW5kb21TcXVhcmVcbiAgICAgICk7XG4gICAgICB3aGlsZSAobW92ZSA9PSAnbm90dmFsaWQnKSB7XG4gICAgICAgIGxldCByYW5kb21TcXVhcmUgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCA5OSk7XG4gICAgICAgIGxldCByYW5kb21UaWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtaWQ9XCIke3JhbmRvbVNxdWFyZX1cIl1gKTtcbiAgICAgICAgbW92ZSA9IHBsYXlHYW1lSGVscGVyKFxuICAgICAgICAgIGN1cnJlbnRQbGF5ZXIsXG4gICAgICAgICAgcGxheWVyT25lLFxuICAgICAgICAgIHJhbmRvbVRpbGUsXG4gICAgICAgICAgcmFuZG9tU3F1YXJlKVxuICAgICAgfVxuICAgICAgaWYgKG1vdmUgIT0gXCJub3R2YWxpZFwiKSB7XG4gICAgICAgIGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXJPbmU7XG4gICAgICAgIGRpc2FibGVTZWxmQ2xpY2tzKGN1cnJlbnRQbGF5ZXIsIGJvYXJkT25lLCBib2FyZFR3byk7XG4gICAgICAgIGlmIChtb3ZlLmF0dGFja1N0YXR1cyA9PSB0cnVlICYmIG1vdmUuc2hpcFN0YXR1cyA9PSBmYWxzZSkge1xuICAgICAgICAgIGxhc3RDb21wdXRlck1vdmUgPSByYW5kb21TcXVhcmVcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsYXN0Q29tcHV0ZXJNb3ZlID0gJydcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIDcwMCk7XG4gIH1cbn1cbn1cblxuZXhwb3J0IHtcbiAgcGxheWVyT25lLFxuICBwbGF5ZXJUd28sXG4gIHBsYXlHYW1lLFxuICBnYW1lT3ZlcixcbiAgY2hlY2tHYW1lU3RhdHVzLFxuICBnYW1lU3RhdHVzLFxufTtcbiIsImltcG9ydCB7XG4gIGNyZWF0ZUdhbWVCb2FyZCxcbiAgc2hvd1NlbGVjdGlvblNjcmVlbixcbiAgc2hvd1NlbGVjdEJvYXJkLFxuICBzaG93R2FtZUJvYXJkLFxuICBhZGRQbGF5ZXJOYW1lLFxuICBuZXdHYW1lLFxufSBmcm9tIFwiLi9kb21cIjtcbmltcG9ydCB7XG4gIHBsYXllck9uZSxcbiAgcGxheWVyVHdvLFxuICBwbGF5R2FtZSxcbn0gZnJvbSBcIi4vZ2FtZWxvZ2ljXCI7XG5pbXBvcnQgeyBhbGxvd0RyYWcsIGFsbG93RHJvcCwgY2hlY2tQb3NpdGlvbnMgfSBmcm9tIFwiLi9kcmFnYW5kZHJvcFwiO1xuXG5jb25zdCBib2FyZE9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRPbmVcIik7XG5jb25zdCBib2FyZFR3byA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRUd29cIik7XG5jb25zdCBwcmVwYXJlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXBhcmVCdXR0b24nKVxuY29uc3QgYmVnaW5CdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJlZ2luQnV0dG9uXCIpO1xuY29uc3QgcGxheWVyT25lTmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyT25lTmFtZVwiKTtcbmNvbnN0IG5ld0dhbWVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5ld0dhbWVCdXR0b25cIik7XG5sZXQgcGxheWVyTmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5ZXJOYW1lXCIpO1xubGV0IGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXJPbmU7XG5cbmxldCBwbGF5ZXJOYW1lID0gXCJcIjtcbnBsYXllck5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICBwbGF5ZXJOYW1lID0gcGxheWVyTmFtZUlucHV0LnZhbHVlO1xufSk7XG5cbnByZXBhcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgc2hvd1NlbGVjdGlvblNjcmVlbigpO1xuICBzaG93U2VsZWN0Qm9hcmQoKTtcbiAgYWxsb3dEcmFnKCk7XG4gIGFsbG93RHJvcCgpO1xuICBjaGVja1Bvc2l0aW9ucygpO1xufSk7XG5cbmJlZ2luQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIHNob3dHYW1lQm9hcmQoKTtcbiAgYWRkUGxheWVyTmFtZShwbGF5ZXJPbmVOYW1lLCBwbGF5ZXJOYW1lKTtcbiAgY3JlYXRlR2FtZUJvYXJkKHBsYXllck9uZSwgYm9hcmRPbmUpO1xuICBjcmVhdGVHYW1lQm9hcmQocGxheWVyVHdvLCBib2FyZFR3byk7XG59KVxuXG5iZWdpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBwbGF5R2FtZShjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pO1xufSk7XG5cblxubmV3R2FtZUJ1dHRvbi5vbmNsaWNrID0gbmV3R2FtZTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVHYW1lQm9hcmQiLCJwbGF5ZXIiLCJib2FyZCIsImkiLCJnYW1lQm9hcmQiLCJsZW5ndGgiLCJnYW1lU3F1YXJlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwicGxheWVyTmFtZSIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwibmV3R2FtZSIsImxvY2F0aW9uIiwicmVsb2FkIiwic2hvd01lc3NhZ2UiLCJtZXNzYWdlIiwiZ2V0RWxlbWVudEJ5SWQiLCJ0ZXh0Q29udGVudCIsImdhbWVCb2FyZEZhY3RvcnkiLCJtaXNzZWRBdHRhY2tzIiwic3VjY2Vzc2Z1bEF0dGFja3MiLCJzdW5rU2hpcHMiLCJwbGFjZVNoaXAiLCJuYW1lT2ZTaGlwIiwiY29vcmRpbmF0ZXMiLCJuZXdTaGlwIiwid2hlcmVIaXQiLCJoaXQiLCJudW1iZXIiLCJwYXJzZUludCIsImluY2x1ZGVzIiwicHVzaCIsImlzU3VuayIsInN1bmtTdGF0dXMiLCJ0aGlzIiwic2hpcEZhY3RvcnkiLCJmb3JFYWNoIiwiY29vcmRpbmF0ZSIsInJlY2VpdmVBdHRhY2siLCJhdHRhY2tTdGF0dXMiLCJzaGlwU3RhdHVzIiwicmVwb3J0IiwibWFwIiwidGlsZSIsInBsYXllckZhY3RvcnkiLCJwbGF5ZXJUeXBlIiwic2VuZEF0dGFjayIsInVuZGVmaW5lZCIsImdldFJhbmRvbUNvb3JkaW5hdGVzIiwibWluIiwibWF4IiwiTWF0aCIsImNlaWwiLCJmbG9vciIsInJhbmRvbSIsImRyYWdnYWJsZVNoaXBzIiwiQXJyYXkiLCJmcm9tIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImFjdGl2YXRlRHJvcCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJzaG93SG92ZXJDb2xvciIsInRhcmdldCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwicmVtb3ZlSG92ZXJDb2xvciIsImRyYWciLCJlIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImdldEF0dHJpYnV0ZSIsImRyb3AiLCJkYXRhIiwiZ2V0RGF0YSIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRQb3NpdGlvbnMiLCJib3hlc1dpdGhTaGlwcyIsImZpbHRlciIsImJveCIsImhhc0NoaWxkTm9kZXMiLCJib3hJRCIsInNoaXBJRCIsImZpcnN0Q2hpbGQiLCJpZCIsImNyZWF0ZVNoaXBDb29yZGluYXRlcyIsInNoaXAiLCJOdW1iZXIiLCJwbGF5ZXJPbmUiLCJiZWdpbkJ1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJwb3NpdGlvbnMiLCJzaGlwcyIsImJveGVzIiwic2hpcE9uZSIsInNoaXBUd28iLCJzaGlwVGhyZWUiLCJzaGlwRm91ciIsInNoaXBGaXZlIiwiY3JlYXRlU2hpcHMiLCJjb21wdXRlckNvb3JkaW5hdGVzIiwiZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiIsInRvU3RyaW5nIiwiZmlyc3RTaGlwQ29vcmRpbmF0ZXMiLCJzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiIsInNlY29uZFNoaXBDb29yZGluYXRlcyIsInRoaXJkU2hpcEZpcnN0UG9zaXRpb24iLCJ0aGlyZFNoaXBDb29yZGluYXRlcyIsImZvdXJ0aFNoaXBGaXJzdFBvc2l0aW9uIiwiZm91cnRoU2hpcENvb3JkaW5hdGVzIiwiZmlmdGhTaGlwRmlyc3RQb3NpdGlvbiIsImZpZnRoU2hpcENvb3JkaW5hdGVzIiwiY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlcyIsInBsYXllclR3byIsImNvbnNvbGUiLCJsb2ciLCJnYW1lU3RhdHVzIiwiZGlzYWJsZVNlbGZDbGlja3MiLCJjdXJyZW50UGxheWVyIiwiYm9hcmRPbmUiLCJib2FyZFR3byIsInBvaW50ZXJFdmVudHMiLCJwbGF5R2FtZUhlbHBlciIsIm9wcG9zaW5nUGxheWVyIiwic3F1YXJlIiwiYXR0YWNrIiwiZ2FtZU92ZXIiLCJsYXN0Q29tcHV0ZXJNb3ZlIiwicGxheUdhbWUiLCJnYW1lT3ZlckNvbnRhaW5lciIsInJlbW92ZSIsImRpc3BsYXlXaW5uZXJUZXh0IiwiaW5uZXJUZXh0IiwibmV3R2FtZUJ1dHRvbiIsIm9uY2xpY2siLCJzaG93R2FtZU92ZXIiLCJwbGF5ZXJPbmVOYW1lIiwibmVpZ2hib3JTcXVhcmUiLCJzZXRUaW1lb3V0IiwibW92ZSIsInJhbmRvbVNxdWFyZSIsInJhbmRvbVRpbGUiLCJwcmVwYXJlQnV0dG9uIiwicGxheWVyTmFtZUlucHV0IiwidmFsdWUiLCJzZWxlY3RCb2FyZCIsInNob3dTZWxlY3RCb2FyZCIsImFkZFBsYXllck5hbWUiXSwic291cmNlUm9vdCI6IiJ9