(()=>{"use strict";function e(e,t){for(let n=0;n<e.gameBoard.board.length;n++){let a=document.createElement("div");a.classList.add("gameSquare"),a.classList.add(e.playerName),a.setAttribute("data-id",n),t.appendChild(a)}}function t(){location.reload()}function n(e){document.getElementById("message").textContent=e}const a=()=>{let e=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],t=[],n=[],a=0;return{board:e,sunkShips:a,successfulAttacks:n,missedAttacks:t,placeShip:function(t,n,a){let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const r=e=>(e=parseInt(e),!!n.includes(e)&&(a.push(e),!0)),i=function(e){return t==a.length?(e=!0,this.sunkStatus=e,e):(e=!1,this.sunkStatus=e,e)};return{nameOfShip:e,length:t,coordinates:n,whereHit:a,sunkStatus:arguments.length>4&&void 0!==arguments[4]&&arguments[4],hit:r,isSunk:i}}(t,n,a);a.forEach((t=>{e[t].push(r)}))},receiveAttack:function(r){if(""!=e[r]){n.push(r);let t=e[r][0].hit(r),i=e[r][0].isSunk();return 1==i&&(a+=1),{attackStatus:t,shipStatus:i}}return t.push(r),!1},report:function(){return e.map((e=>{if(""!=e)return e[0].isSunk(),1==e[0].sunkStatus})).includes(!1)?"There are still alive ships":"All ships have sunk!"}}},r=function(e,t){return{playerName:e,sendAttack:function(e,t){let n="valid";return(e.missedAttacks.includes(t)||null!=e.successfulAttacks&&e.successfulAttacks.includes(t))&&(n="notValid"),"valid"==n?e.receiveAttack(t):"notvalid"},gameBoard:a()}};function i(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}const o=Array.from(document.getElementsByClassName("draggable"));function s(e){e.preventDefault()}function d(e){e.target.style.backgroundColor="aqua"}function l(e){e.target.style.backgroundColor=null}function c(e){e.dataTransfer.setData("text",e.target.getAttribute("id"))}function u(e){e.preventDefault();let t=e.dataTransfer.getData("text"),n=e.target;l(e),n.appendChild(document.querySelector(`[id="${t}"]`))}function m(){let e=Array.from(document.getElementsByClassName("droppable")).filter((e=>{if(e.hasChildNodes())return e}));return{boxID:e.map((e=>e.getAttribute("set-id"))),shipID:e.map((e=>e.firstChild.id))}}function h(e,t){return t=Number(t),"carrier"==e?[t,t+1,t+2,t+3,t+4]:"battleship"==e?[t,t+1,t+2,t+3]:"cruiser"==e||"submarine"==e?[t,t+1,t+2]:"destroyer"==e?[t,t+1]:void 0}let p=r("playerOne");beginButton.addEventListener("click",(function(){let e=m(),t=function(e,t){return{shipOne:h(t[0],e[0]),shipTwo:h(t[1],e[1]),shipThree:h(t[2],e[2]),shipFour:h(t[3],e[3]),shipFive:h(t[4],e[4])}}(e.boxID,e.shipID);p.gameBoard.placeShip("carrier",t.shipOne.length,t.shipOne),p.gameBoard.placeShip("battleship",t.shipTwo.length,t.shipTwo),p.gameBoard.placeShip("submarine",t.shipThree.length,t.shipThree),p.gameBoard.placeShip("cruiser",t.shipFour.length,t.shipFour),p.gameBoard.placeShip("destroyer",t.shipFive.length,t.shipFive)}));let g=function(){let e=i(0,2).toString()+i(0,5).toString();e=Number(e);let t=[e,e+1,e+2,e+3,e+4],n=i(3,4).toString()+i(0,6).toString();n=Number(n);let a=[n,n+1,n+2,n+3],r=i(7,8).toString()+i(0,7).toString();r=Number(r);let o=[r,r+1,r+2],s="9"+i(0,7).toString();s=Number(s);let d=[s,s+1,s+2],l=i(5,6).toString()+i(0,7).toString();return l=Number(l),{firstShipCoordinates:t,secondShipCoordinates:a,thirdShipCoordinates:o,fourthShipCoordinates:d,fifthShipCoordinates:[l,l+1]}}(),f=r("playerTwo");f.gameBoard.placeShip("carrier",5,g.firstShipCoordinates),f.gameBoard.placeShip("battleship",4,g.secondShipCoordinates),f.gameBoard.placeShip("submarine",3,g.thirdShipCoordinates),f.gameBoard.placeShip("cruiser",3,g.fourthShipCoordinates),f.gameBoard.placeShip("destroyer",2,g.fifthShipCoordinates),console.log(f.gameBoard.board);let S="";function v(e,t,n){e==p?(t.style.pointerEvents="none",n.style.pointerEvents="auto"):e==f&&(n.style.pointerEvents="none",t.style.pointerEvents="auto")}function y(e,t,a,r){let i=e.sendAttack(t.gameBoard,r);if("notvalid"==i)return n("That move is not valid. Please pick another tile."),"notvalid";1==i.attackStatus?(a.style.backgroundColor="green",n("")):0==i&&(a.style.backgroundColor="red",n("")),1==i.shipStatus&&n("A ship becomes feast for the fishes!"),S=function(e){return"All ships have sunk!"==e.gameBoard.report()}(t)}function E(e,n,a){if(v(e,n,a),Array.from(document.getElementsByClassName("gameSquare")).forEach((r=>{r.addEventListener("click",(function(){let i=r.getAttribute("data-id");e==p&&("notvalid"!=y(e,f,r,i)&&(v(e=f,n,a),E(e,n,a)),1==S&&function(e){document.getElementById("mainContainer").classList.add("hidden");const n=document.getElementById("gameOverContainer");n.classList.remove("hidden");let a=document.createElement("h1");a.innerText=`The game is over. ${e} has won!`,n.appendChild(a);const r=document.createElement("button");r.textContent="Start New Game",r.classList.add("newgame"),r.onclick=t,n.appendChild(r)}(e==p?playerOneName.textContent:"Computer"))}))})),e==f){let t=i(0,99),r=document.querySelector(`[data-id="${t}"]`);setTimeout((()=>{let o=y(e,p,r,t);for(;"notvalid"==o;){let t=i(0,99),n=document.querySelector(`[data-id="${t}"]`);o=y(e,p,n,t)}"notvalid"!=o&&v(e=p,n,a)}),700)}}const B=document.getElementById("boardOne"),b=document.getElementById("boardTwo"),C=document.getElementById("prepareButton"),k=document.getElementById("beginButton"),L=document.getElementById("playerOneName"),A=document.getElementById("newGameButton");let I=document.getElementById("playerName"),N=p,T="";I.addEventListener("input",(function(){T=I.value})),C.addEventListener("click",(function(){document.getElementById("welcomeScreenContainer").classList.add("hidden"),document.getElementById("selectScreenContainer").classList.remove("hidden"),function(){const e=document.getElementById("selectBoard");for(let t=0;t<100;t++){let n=document.createElement("div");n.classList.add("selectSquare"),n.classList.add("droppable"),n.setAttribute("set-id",t),e.appendChild(n)}}(),o.forEach((e=>{e.addEventListener("dragstart",c)})),Array.from(document.getElementsByClassName("droppable")).forEach((e=>{e.addEventListener("dragover",s),e.addEventListener("dragover",d),e.addEventListener("dragleave",l),e.addEventListener("drop",u)})),Array.from(document.getElementsByClassName("droppable")).forEach((e=>{e.addEventListener("drop",(function(){5==m().boxID.length&&document.getElementById("beginButton").classList.remove("hidden")}))}))})),k.addEventListener("click",(function(){document.getElementById("selectScreenContainer").classList.add("hidden"),document.getElementById("mainContainer").classList.remove("hidden"),function(e,t){e.textContent=""!=t?t:"Anonymous Challenger's Board"}(L,T),e(p,B),e(f,b)})),k.addEventListener("click",(function(){E(N,B,b)})),A.onclick=t})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBU1ksZUFBZSxlQUNoQ1YsVUFBVTJILE9BQU8sU0FFcEMsR0FORCxHRXRCUCxJQUVEeEMsRUFBWUMsaUJBQWlCLFNBQVMsV0xmTnRGLFNBQVNZLGVBQ3JDLHlCQUVvQlYsVUFBVUMsSUFBSSxVQUNkSCxTQUFTWSxlQUFlLGlCQUNoQ1YsVUFBVTJILE9BQU8sVUFhakMsU0FBdUJuSSxFQUFRVSxHQUUzQlYsRUFBT21CLFlBRFMsSUFBZFQsRUFDbUJBLEVBRUEsOEJBRXhCLENLUEN5SSxDQUFjVixFQUFlL0gsR0FDN0JYLEVBQWdCMkYsRUFBVytCLEdBQzNCMUgsRUFBZ0JvSCxFQUFXTyxFQUM1QixJQUVEL0IsRUFBWUMsaUJBQWlCLFNBQVMsV0FDcENxQyxFQUFTVCxFQUFlQyxFQUFVQyxFQUNuQyxJQUdEWSxFQUFjQyxRQUFVMUgsQyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZG9tLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yeUZ1bmN0aW9ucy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NvbXB1dGVyY29vcmRpbmF0ZXMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9kcmFnYW5kZHJvcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVsb2dpYy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHNob3dTZWxlY3Rpb25TY3JlZW4oKSB7XG4gIGNvbnN0IHdlbGNvbWVTY3JlZW5Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICBcIndlbGNvbWVTY3JlZW5Db250YWluZXJcIlxuICApO1xuICB3ZWxjb21lU2NyZWVuQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gIGNvbnN0IHNlbGVjdFNjcmVlbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgIFwic2VsZWN0U2NyZWVuQ29udGFpbmVyXCJcbiAgKTtcbiAgc2VsZWN0U2NyZWVuQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG59XG5cbmZ1bmN0aW9uIHNob3dTZWxlY3RCb2FyZCgpIHtcbiAgY29uc3Qgc2VsZWN0Qm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNlbGVjdEJvYXJkXCIpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgbGV0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdFNxdWFyZScpO1xuICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdkcm9wcGFibGUnKTtcbiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic2V0LWlkXCIsIGkpO1xuICAgIHNlbGVjdEJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2hvd0dhbWVCb2FyZCgpIHtcbiAgY29uc3Qgc2VsZWN0U2NyZWVuQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgXCJzZWxlY3RTY3JlZW5Db250YWluZXJcIlxuICApO1xuICBzZWxlY3RTY3JlZW5Db250YWluZXIuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgY29uc3QgbWFpbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpbkNvbnRhaW5lclwiKTtcbiAgbWFpbkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVHYW1lQm9hcmQocGxheWVyLCBib2FyZCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHBsYXllci5nYW1lQm9hcmQuYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICBsZXQgZ2FtZVNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZ2FtZVNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiZ2FtZVNxdWFyZVwiKTtcbiAgICBnYW1lU3F1YXJlLmNsYXNzTGlzdC5hZGQocGxheWVyLnBsYXllck5hbWUpO1xuICAgIGdhbWVTcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBpKTtcbiAgICBib2FyZC5hcHBlbmRDaGlsZChnYW1lU3F1YXJlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRQbGF5ZXJOYW1lKHBsYXllciwgcGxheWVyTmFtZSkge1xuICBpZiAocGxheWVyTmFtZSAhPSBcIlwiKSB7XG4gICAgcGxheWVyLnRleHRDb250ZW50ID0gcGxheWVyTmFtZTtcbiAgfSBlbHNlIHtcbiAgICBwbGF5ZXIudGV4dENvbnRlbnQgPSBcIkFub255bW91cyBDaGFsbGVuZ2VyJ3MgQm9hcmRcIjtcbiAgfVxufVxuXG5mdW5jdGlvbiBuZXdHYW1lKCkge1xuICBsb2NhdGlvbi5yZWxvYWQoKTtcbn1cblxuZnVuY3Rpb24gc2hvd0dhbWVPdmVyKGN1cnJlbnRQbGF5ZXIpIHtcbiAgY29uc3QgbWFpbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpbkNvbnRhaW5lclwiKTtcbiAgbWFpbkNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICBjb25zdCBnYW1lT3ZlckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ2FtZU92ZXJDb250YWluZXJcIik7XG4gIGdhbWVPdmVyQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpXG4gIGxldCBkaXNwbGF5V2lubmVyVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMVwiKTtcbiAgZGlzcGxheVdpbm5lclRleHQuaW5uZXJUZXh0ID0gYFRoZSBnYW1lIGlzIG92ZXIuICR7Y3VycmVudFBsYXllcn0gaGFzIHdvbiFgO1xuICBnYW1lT3ZlckNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXNwbGF5V2lubmVyVGV4dCk7XG4gIGNvbnN0IG5ld0dhbWVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICBuZXdHYW1lQnV0dG9uLnRleHRDb250ZW50ID0gXCJTdGFydCBOZXcgR2FtZVwiO1xuICBuZXdHYW1lQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJuZXdnYW1lXCIpO1xuICBuZXdHYW1lQnV0dG9uLm9uY2xpY2sgPSBuZXdHYW1lO1xuICBnYW1lT3ZlckNvbnRhaW5lci5hcHBlbmRDaGlsZChuZXdHYW1lQnV0dG9uKTtcbn1cblxuZnVuY3Rpb24gc2hvd01lc3NhZ2UobWVzc2FnZSkge1xuICBjb25zdCBtZXNzYWdlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtZXNzYWdlXCIpO1xuICBtZXNzYWdlQ29udGFpbmVyLnRleHRDb250ZW50ID0gbWVzc2FnZTtcbn1cblxuZXhwb3J0IHtcbiAgY3JlYXRlR2FtZUJvYXJkLFxuICBzaG93U2VsZWN0aW9uU2NyZWVuLFxuICBzaG93U2VsZWN0Qm9hcmQsXG4gIHNob3dHYW1lQm9hcmQsXG4gIGFkZFBsYXllck5hbWUsXG4gIG5ld0dhbWUsXG4gIHNob3dHYW1lT3ZlcixcbiAgc2hvd01lc3NhZ2UsXG59O1xuIiwiY29uc3Qgc2hpcEZhY3RvcnkgPSAoXG4gIG5hbWVPZlNoaXAsXG4gIGxlbmd0aCxcbiAgY29vcmRpbmF0ZXMgPSBbXSxcbiAgd2hlcmVIaXQgPSBbXSxcbiAgc3Vua1N0YXR1cyA9IGZhbHNlXG4pID0+IHtcbiAgY29uc3QgaGl0ID0gKG51bWJlcikgPT4ge1xuICAgIG51bWJlciA9IHBhcnNlSW50KG51bWJlcilcbiAgIGlmIChjb29yZGluYXRlcy5pbmNsdWRlcyhudW1iZXIpKSB7XG4gICAgICAgIHdoZXJlSGl0LnB1c2gobnVtYmVyKTtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuICAgIH07XG4gIGNvbnN0IGlzU3VuayA9IGZ1bmN0aW9uIChzdW5rU3RhdHVzKSB7XG4gICAgaWYgKGxlbmd0aCA9PSB3aGVyZUhpdC5sZW5ndGgpIHtcbiAgICAgIHN1bmtTdGF0dXMgPSB0cnVlO1xuICAgICAgdGhpcy5zdW5rU3RhdHVzID0gc3Vua1N0YXR1c1xuICAgICAgcmV0dXJuIHN1bmtTdGF0dXM7XG4gICAgfSBlbHNlIHtcbiAgICBzdW5rU3RhdHVzID0gZmFsc2U7XG4gICAgdGhpcy5zdW5rU3RhdHVzID0gc3Vua1N0YXR1c1xuICAgIHJldHVybiBzdW5rU3RhdHVzO1xuICB9fTtcbiAgcmV0dXJuIHsgbmFtZU9mU2hpcCwgbGVuZ3RoLCBjb29yZGluYXRlcywgd2hlcmVIaXQsIHN1bmtTdGF0dXMsIGhpdCwgaXNTdW5rIH07XG59O1xuXG5cbi8vZ2FtZUJvYXJkIGlzIDEweDEwXG5cbmNvbnN0IGdhbWVCb2FyZEZhY3RvcnkgPSAoKSA9PiB7XG4gIGxldCBib2FyZCA9IFtcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSxcbiAgICBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXVxuICBdXG4gIGxldCBtaXNzZWRBdHRhY2tzID0gW11cbiAgbGV0IHN1Y2Nlc3NmdWxBdHRhY2tzID0gW11cbiAgbGV0IHN1bmtTaGlwcyA9IDBcbiAgY29uc3QgcGxhY2VTaGlwID0gZnVuY3Rpb24gKG5hbWVPZlNoaXAsIGxlbmd0aCwgY29vcmRpbmF0ZXMpIHtcbiAgICBsZXQgbmV3U2hpcCA9IHNoaXBGYWN0b3J5KG5hbWVPZlNoaXAsIGxlbmd0aCwgY29vcmRpbmF0ZXMpO1xuICAgIGNvb3JkaW5hdGVzLmZvckVhY2goY29vcmRpbmF0ZSA9PiB7XG4gICAgICBib2FyZFtjb29yZGluYXRlXS5wdXNoKG5ld1NoaXApXG4gICAgfSlcbiAgICB9XG4gIDtcbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IGZ1bmN0aW9uKG51bWJlcikge1xuICAgIGlmIChib2FyZFtudW1iZXJdICE9IFwiXCIpIHtcbiAgICAgIHN1Y2Nlc3NmdWxBdHRhY2tzLnB1c2gobnVtYmVyKTtcbiAgICAgIGxldCBhdHRhY2tTdGF0dXMgPSBib2FyZFtudW1iZXJdWzBdLmhpdChudW1iZXIpO1xuICAgICAgbGV0IHNoaXBTdGF0dXMgPSBib2FyZFtudW1iZXJdWzBdLmlzU3VuaygpXG4gICAgICBpZiAoc2hpcFN0YXR1cyA9PSB0cnVlKSB7XG4gICAgICAgIHN1bmtTaGlwcyArPSAxXG4gICAgICB9XG4gICAgICByZXR1cm4ge2F0dGFja1N0YXR1cywgc2hpcFN0YXR1c31cbiAgICB9IGVsc2UgeyAgICAgIFxuICAgICAgbWlzc2VkQXR0YWNrcy5wdXNoKG51bWJlcik7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9IFxuICB9O1xuICBjb25zdCByZXBvcnQgPSBmdW5jdGlvbigpIHtcbiAgICBsZXQgY2hlY2tTdGF0dXMgPSBib2FyZC5tYXAoKHRpbGUpID0+IHtcbiAgICAgIGlmICh0aWxlICE9ICcnKSB7XG4gICAgICAgIHRpbGVbMF0uaXNTdW5rKClcbiAgICAgIGlmICh0aWxlWzBdLnN1bmtTdGF0dXMgPT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICAgIGlmIChjaGVja1N0YXR1cy5pbmNsdWRlcyhmYWxzZSkpIHtcbiAgICAgIHJldHVybiBcIlRoZXJlIGFyZSBzdGlsbCBhbGl2ZSBzaGlwc1wiO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJBbGwgc2hpcHMgaGF2ZSBzdW5rIVwiO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4geyBib2FyZCwgc3Vua1NoaXBzLCBzdWNjZXNzZnVsQXR0YWNrcywgbWlzc2VkQXR0YWNrcywgcGxhY2VTaGlwLCByZWNlaXZlQXR0YWNrLCByZXBvcnQgfTtcbn07XG5cbi8vcGxheWVyIEZhY3RvcnlcblxuXG5jb25zdCBwbGF5ZXJGYWN0b3J5ID0gZnVuY3Rpb24ocGxheWVyTmFtZSwgcGxheWVyVHlwZSkge1xuICBjb25zdCBnYW1lQm9hcmQgPSBnYW1lQm9hcmRGYWN0b3J5KCk7ICAgXG4gICAgY29uc3Qgc2VuZEF0dGFjayA9IGZ1bmN0aW9uKGJvYXJkLCBjb29yZGluYXRlKSB7XG4gICAgICBsZXQgYXR0YWNrU3RhdHVzID0gJ3ZhbGlkJ1xuICAgICAgaWYgKGJvYXJkLm1pc3NlZEF0dGFja3MuaW5jbHVkZXMoY29vcmRpbmF0ZSkpIHtcbiAgICAgICAgICBhdHRhY2tTdGF0dXMgPSAnbm90VmFsaWQnXG4gICAgICAgIH0gZWxzZSBpZiAoYm9hcmQuc3VjY2Vzc2Z1bEF0dGFja3MgIT0gdW5kZWZpbmVkICYmIGJvYXJkLnN1Y2Nlc3NmdWxBdHRhY2tzLmluY2x1ZGVzKGNvb3JkaW5hdGUpKSB7XG4gICAgICAgICAgYXR0YWNrU3RhdHVzID0gJ25vdFZhbGlkJ1xuICAgICAgIH1cbiAgICAgICBpZiAoYXR0YWNrU3RhdHVzID09ICd2YWxpZCcpIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSlcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnbm90dmFsaWQnXG4gICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge3BsYXllck5hbWUsIHNlbmRBdHRhY2ssIGdhbWVCb2FyZH1cbn1cblxuZXhwb3J0IHsgZ2FtZUJvYXJkRmFjdG9yeSwgcGxheWVyRmFjdG9yeSwgc2hpcEZhY3RvcnkgfTtcbiIsImZ1bmN0aW9uIGdldFJhbmRvbUNvb3JkaW5hdGVzKG1pbiwgbWF4KSB7XG4gIG1pbiA9IE1hdGguY2VpbChtaW4pO1xuICBtYXggPSBNYXRoLmZsb29yKG1heCk7XG4gIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluKSArIG1pbik7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbXB1dGVyQ29vcmRpbmF0ZXMoKSB7XG4gIGxldCBmaXJzdFNoaXBGaXJzdE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDIpLnRvU3RyaW5nKCk7XG4gIGxldCBmaXJzdFNoaXBTZWNvbmROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCA1KS50b1N0cmluZygpO1xuICBsZXQgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiA9IGZpcnN0U2hpcEZpcnN0TnVtYmVyICsgZmlyc3RTaGlwU2Vjb25kTnVtYmVyO1xuICBmaXJzdFNoaXBGaXJzdFBvc2l0aW9uID0gTnVtYmVyKGZpcnN0U2hpcEZpcnN0UG9zaXRpb24pO1xuICBsZXQgZmlyc3RTaGlwQ29vcmRpbmF0ZXMgPSBbXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbixcbiAgICBmaXJzdFNoaXBGaXJzdFBvc2l0aW9uICsgMSxcbiAgICBmaXJzdFNoaXBGaXJzdFBvc2l0aW9uICsgMixcbiAgICBmaXJzdFNoaXBGaXJzdFBvc2l0aW9uICsgMyxcbiAgICBmaXJzdFNoaXBGaXJzdFBvc2l0aW9uICsgNCxcbiAgXTtcbiAgbGV0IHNlY29uZFNoaXBGaXJzdE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDMsIDQpLnRvU3RyaW5nKCk7XG4gIGxldCBzZWNvbmRTaGlwU2Vjb25kTnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoMCwgNikudG9TdHJpbmcoKTtcbiAgbGV0IHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uID0gc2Vjb25kU2hpcEZpcnN0TnVtYmVyICsgc2Vjb25kU2hpcFNlY29uZE51bWJlcjtcbiAgc2Vjb25kU2hpcEZpcnN0UG9zaXRpb24gPSBOdW1iZXIoc2Vjb25kU2hpcEZpcnN0UG9zaXRpb24pO1xuICBsZXQgc2Vjb25kU2hpcENvb3JkaW5hdGVzID0gW1xuICAgIHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uLFxuICAgIHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uICsgMSxcbiAgICBzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiArIDIsXG4gICAgc2Vjb25kU2hpcEZpcnN0UG9zaXRpb24gKyAzLFxuICBdO1xuICBsZXQgdGhpcmRTaGlwRmlyc3ROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcyg3LCA4KS50b1N0cmluZygpO1xuICBsZXQgdGhpcmRTaGlwU2Vjb25kTnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoMCwgNykudG9TdHJpbmcoKTtcbiAgbGV0IHRoaXJkU2hpcEZpcnN0UG9zaXRpb24gPSB0aGlyZFNoaXBGaXJzdE51bWJlciArIHRoaXJkU2hpcFNlY29uZE51bWJlcjtcbiAgdGhpcmRTaGlwRmlyc3RQb3NpdGlvbiA9IE51bWJlcih0aGlyZFNoaXBGaXJzdFBvc2l0aW9uKTtcbiAgbGV0IHRoaXJkU2hpcENvb3JkaW5hdGVzID0gW1xuICAgIHRoaXJkU2hpcEZpcnN0UG9zaXRpb24sXG4gICAgdGhpcmRTaGlwRmlyc3RQb3NpdGlvbiArIDEsXG4gICAgdGhpcmRTaGlwRmlyc3RQb3NpdGlvbiArIDIsXG4gIF07XG4gIGxldCBmb3VydGhTaGlwRmlyc3ROdW1iZXIgPSBcIjlcIlxuICBsZXQgZm91cnRoU2hpcFNlY29uZE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDcpLnRvU3RyaW5nKCk7XG4gIGxldCBmb3VydGhTaGlwRmlyc3RQb3NpdGlvbiA9IGZvdXJ0aFNoaXBGaXJzdE51bWJlciArIGZvdXJ0aFNoaXBTZWNvbmROdW1iZXI7XG4gIGZvdXJ0aFNoaXBGaXJzdFBvc2l0aW9uID0gTnVtYmVyKGZvdXJ0aFNoaXBGaXJzdFBvc2l0aW9uKTtcbiAgbGV0IGZvdXJ0aFNoaXBDb29yZGluYXRlcyA9IFtcbiAgICBmb3VydGhTaGlwRmlyc3RQb3NpdGlvbixcbiAgICBmb3VydGhTaGlwRmlyc3RQb3NpdGlvbiArIDEsXG4gICAgZm91cnRoU2hpcEZpcnN0UG9zaXRpb24gKyAyLFxuICBdO1xuICBsZXQgZmlmdGhTaGlwRmlyc3ROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcyg1LCA2KS50b1N0cmluZygpO1xuICBsZXQgZmlmdGhTaGlwU2Vjb25kTnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoMCwgNykudG9TdHJpbmcoKTtcbiAgbGV0IGZpZnRoU2hpcEZpcnN0UG9zaXRpb24gPSBmaWZ0aFNoaXBGaXJzdE51bWJlciArIGZpZnRoU2hpcFNlY29uZE51bWJlcjtcbiAgZmlmdGhTaGlwRmlyc3RQb3NpdGlvbiA9IE51bWJlcihmaWZ0aFNoaXBGaXJzdFBvc2l0aW9uKTtcbiAgbGV0IGZpZnRoU2hpcENvb3JkaW5hdGVzID0gW2ZpZnRoU2hpcEZpcnN0UG9zaXRpb24sIGZpZnRoU2hpcEZpcnN0UG9zaXRpb24gKyAxXTtcbiAgcmV0dXJuIHtmaXJzdFNoaXBDb29yZGluYXRlcywgc2Vjb25kU2hpcENvb3JkaW5hdGVzLCB0aGlyZFNoaXBDb29yZGluYXRlcywgZm91cnRoU2hpcENvb3JkaW5hdGVzLCBmaWZ0aFNoaXBDb29yZGluYXRlc31cbn1cblxuZXhwb3J0IHtnZXRSYW5kb21Db29yZGluYXRlcywgY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlc31cbiIsImNvbnN0IGRyYWdnYWJsZVNoaXBzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkcmFnZ2FibGUnKSkgXG5cbmZ1bmN0aW9uIGFjdGl2YXRlRHJvcChldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59XG5cbmZ1bmN0aW9uIHNob3dIb3ZlckNvbG9yKGV2ZW50KSB7XG4gICAgZXZlbnQudGFyZ2V0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdhcXVhJ1xufVxuXG5mdW5jdGlvbiByZW1vdmVIb3ZlckNvbG9yKGV2ZW50KXtcbiAgICBldmVudC50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gbnVsbFxufVxuXG5mdW5jdGlvbiBkcmFnKGUpIHtcbiAgICBlLmRhdGFUcmFuc2Zlci5zZXREYXRhKCd0ZXh0JywgZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdpZCcpKVxufVxuXG5mdW5jdGlvbiBkcm9wKGUpe1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgZGF0YSA9IGUuZGF0YVRyYW5zZmVyLmdldERhdGEoJ3RleHQnKVxuICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldFxuICAgIHJlbW92ZUhvdmVyQ29sb3IoZSlcbiAgIHRhcmdldC5hcHBlbmRDaGlsZChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbaWQ9XCIke2RhdGF9XCJdYCkpXG59XG5cblxubGV0IGFsbG93RHJhZyA9IGZ1bmN0aW9uKCkge1xuICAgIGRyYWdnYWJsZVNoaXBzLmZvckVhY2goc2hpcCA9PiB7XG4gICAgc2hpcC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBkcmFnKVxufSlcbn1cblxubGV0IGFsbG93RHJvcCA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHNlbGVjdEJveGVzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkcm9wcGFibGUnKSlcbiAgICBzZWxlY3RCb3hlcy5mb3JFYWNoKGJveCA9PiB7XG4gICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgYWN0aXZhdGVEcm9wKVxuICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHNob3dIb3ZlckNvbG9yKVxuICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdkcmFnbGVhdmUnLCByZW1vdmVIb3ZlckNvbG9yKVxuICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZHJvcClcbn0pXG59XG5cbmZ1bmN0aW9uIGdldFBvc2l0aW9ucygpe1xuICAgIGNvbnN0IHNlbGVjdEJveGVzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkcm9wcGFibGUnKSlcbiAgICBsZXQgYm94ZXNXaXRoU2hpcHMgPSBzZWxlY3RCb3hlcy5maWx0ZXIoYm94ID0+IHtcbiAgICAgICAgaWYgKGJveC5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBib3hcbiAgICAgICAgfVxuICAgIH0pXG4gICAgbGV0IGJveElEID0gYm94ZXNXaXRoU2hpcHMubWFwKGJveCA9PiBib3guZ2V0QXR0cmlidXRlKCdzZXQtaWQnKSlcbiAgICBsZXQgc2hpcElEID0gYm94ZXNXaXRoU2hpcHMubWFwKGJveCA9PiBib3guZmlyc3RDaGlsZC5pZClcbiAgICByZXR1cm4ge2JveElELCBzaGlwSUR9XG59XG5cbmZ1bmN0aW9uIGNoZWNrUG9zaXRpb25zKCkge1xuICAgIGNvbnN0IHNlbGVjdEJveGVzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkcm9wcGFibGUnKSlcbiAgICBzZWxlY3RCb3hlcy5mb3JFYWNoKGJveCA9PiB7XG4gICAgICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgY2hlY2sgPSBnZXRQb3NpdGlvbnMoKVxuICAgICAgICAgICAgaWYgKGNoZWNrLmJveElELmxlbmd0aCA9PSA1KXtcbiAgICAgICAgICAgICAgICBjb25zdCBiZWdpbkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmVnaW5CdXR0b25cIik7XG4gICAgICAgICAgICAgICAgYmVnaW5CdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJylcbiAgICAgICAgICAgIH0gXG4gICAgICAgIH0pXG59KVxufVxuXG5mdW5jdGlvbiBjcmVhdGVTaGlwQ29vcmRpbmF0ZXMoc2hpcCwgYm94KSB7XG4gICAgYm94ID0gTnVtYmVyKGJveClcbiAgICBpZiAoc2hpcCA9PSAnY2FycmllcicpIHtcbiAgICAgICAgbGV0IGNvb3JkaW5hdGVzID0gW2JveCwgYm94KzEsIGJveCsyLCBib3grMywgYm94KzRdXG4gICAgICAgIHJldHVybiBjb29yZGluYXRlc1xuICAgIH1cbiAgICBpZiAoc2hpcCA9PSAnYmF0dGxlc2hpcCcpIHtcbiAgICBsZXQgY29vcmRpbmF0ZXMgPSBbYm94LCBib3grMSwgYm94KzIsIGJveCszXVxuICAgICAgICByZXR1cm4gY29vcmRpbmF0ZXNcbiAgICB9XG4gICAgaWYgKHNoaXAgPT0gJ2NydWlzZXInIHx8IHNoaXAgPT0gJ3N1Ym1hcmluZScpIHtcbiAgICAgICAgbGV0IGNvb3JkaW5hdGVzID0gW2JveCwgYm94KzEsIGJveCsyXVxuICAgICAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzXG4gICAgfVxuICAgIGlmIChzaGlwID09ICdkZXN0cm95ZXInKSB7XG4gICAgICAgICAgICBsZXQgY29vcmRpbmF0ZXMgPSBbYm94LCBib3grMV1cbiAgICAgICAgICAgICAgICByZXR1cm4gY29vcmRpbmF0ZXNcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNoaXBzKGJveGVzLCBzaGlwcykge1xuICAgIGxldCBzaGlwT25lID0gY3JlYXRlU2hpcENvb3JkaW5hdGVzKHNoaXBzWzBdLCBib3hlc1swXSlcbiAgICBsZXQgc2hpcFR3byA9IGNyZWF0ZVNoaXBDb29yZGluYXRlcyhzaGlwc1sxXSwgYm94ZXNbMV0pXG4gICAgbGV0IHNoaXBUaHJlZSA9IGNyZWF0ZVNoaXBDb29yZGluYXRlcyhzaGlwc1syXSwgYm94ZXNbMl0pXG4gICAgbGV0IHNoaXBGb3VyID0gY3JlYXRlU2hpcENvb3JkaW5hdGVzKHNoaXBzWzNdLCBib3hlc1szXSlcbiAgICBsZXQgc2hpcEZpdmUgPSBjcmVhdGVTaGlwQ29vcmRpbmF0ZXMoc2hpcHNbNF0sIGJveGVzWzRdKVxuICAgIHJldHVybiB7c2hpcE9uZSwgc2hpcFR3bywgc2hpcFRocmVlLCBzaGlwRm91ciwgc2hpcEZpdmV9XG59XG5cbmV4cG9ydCB7YWxsb3dEcmFnLCBhbGxvd0Ryb3AsIGdldFBvc2l0aW9ucywgY2hlY2tQb3NpdGlvbnMsIGNyZWF0ZVNoaXBzfSIsImltcG9ydCB7IHBsYXllckZhY3RvcnkgfSBmcm9tIFwiLi9mYWN0b3J5RnVuY3Rpb25zXCI7XG5pbXBvcnQgeyBzaG93TWVzc2FnZSwgc2hvd0dhbWVPdmVyIH0gZnJvbSBcIi4vZG9tXCI7XG5pbXBvcnQgeyBnZXRSYW5kb21Db29yZGluYXRlcywgY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlcyB9IGZyb20gJy4vY29tcHV0ZXJjb29yZGluYXRlcydcbmltcG9ydCB7IGdldFBvc2l0aW9ucywgY3JlYXRlU2hpcHMgfSBmcm9tICcuL2RyYWdhbmRkcm9wJ1xuXG5sZXQgcGxheWVyT25lID0gcGxheWVyRmFjdG9yeShcInBsYXllck9uZVwiLCBcInBlcnNvblwiKTtcblxuXG5iZWdpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gIGxldCBwb3NpdGlvbnMgPSBnZXRQb3NpdGlvbnMoKVxuICBsZXQgc2hpcHMgPSBjcmVhdGVTaGlwcyhwb3NpdGlvbnMuYm94SUQsIHBvc2l0aW9ucy5zaGlwSUQpXG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY2FycmllclwiLCBzaGlwcy5zaGlwT25lLmxlbmd0aCwgc2hpcHMuc2hpcE9uZSk7XG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwiYmF0dGxlc2hpcFwiLCBzaGlwcy5zaGlwVHdvLmxlbmd0aCwgc2hpcHMuc2hpcFR3byk7XG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwic3VibWFyaW5lXCIsIHNoaXBzLnNoaXBUaHJlZS5sZW5ndGgsIHNoaXBzLnNoaXBUaHJlZSk7XG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY3J1aXNlclwiLCBzaGlwcy5zaGlwRm91ci5sZW5ndGgsIHNoaXBzLnNoaXBGb3VyKTtcbiAgcGxheWVyT25lLmdhbWVCb2FyZC5wbGFjZVNoaXAoXCJkZXN0cm95ZXJcIiwgc2hpcHMuc2hpcEZpdmUubGVuZ3RoLCBzaGlwcy5zaGlwRml2ZSk7XG59KVxuXG5cbmxldCBjb21wdXRlckNvb3JkaW5hdGVzID0gY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlcygpXG5sZXQgcGxheWVyVHdvID0gcGxheWVyRmFjdG9yeShcInBsYXllclR3b1wiLCBcIkNvbXB1dGVyXCIpO1xucGxheWVyVHdvLmdhbWVCb2FyZC5wbGFjZVNoaXAoXCJjYXJyaWVyXCIsIDUsIGNvbXB1dGVyQ29vcmRpbmF0ZXMuZmlyc3RTaGlwQ29vcmRpbmF0ZXMpO1xucGxheWVyVHdvLmdhbWVCb2FyZC5wbGFjZVNoaXAoXCJiYXR0bGVzaGlwXCIsIDQsIGNvbXB1dGVyQ29vcmRpbmF0ZXMuc2Vjb25kU2hpcENvb3JkaW5hdGVzKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwic3VibWFyaW5lXCIsIDMsIGNvbXB1dGVyQ29vcmRpbmF0ZXMudGhpcmRTaGlwQ29vcmRpbmF0ZXMpO1xucGxheWVyVHdvLmdhbWVCb2FyZC5wbGFjZVNoaXAoXCJjcnVpc2VyXCIsIDMsIGNvbXB1dGVyQ29vcmRpbmF0ZXMuZm91cnRoU2hpcENvb3JkaW5hdGVzKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwiZGVzdHJveWVyXCIsIDIsIGNvbXB1dGVyQ29vcmRpbmF0ZXMuZmlmdGhTaGlwQ29vcmRpbmF0ZXMpO1xuY29uc29sZS5sb2cocGxheWVyVHdvLmdhbWVCb2FyZC5ib2FyZClcblxubGV0IGdhbWVTdGF0dXMgPSBcIlwiO1xuXG5mdW5jdGlvbiBkaXNhYmxlU2VsZkNsaWNrcyhjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pIHtcbiAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyT25lKSB7XG4gICAgYm9hcmRPbmUuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICAgIGJvYXJkVHdvLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImF1dG9cIjtcbiAgfSBlbHNlIGlmIChjdXJyZW50UGxheWVyID09IHBsYXllclR3bykge1xuICAgIGJvYXJkVHdvLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgICBib2FyZE9uZS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJhdXRvXCI7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2FtZU92ZXIob3Bwb3NpbmdQbGF5ZXIpIHtcbiAgbGV0IHJlcG9ydCA9IG9wcG9zaW5nUGxheWVyLmdhbWVCb2FyZC5yZXBvcnQoKTtcbiAgaWYgKHJlcG9ydCA9PSBcIkFsbCBzaGlwcyBoYXZlIHN1bmshXCIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2hlY2tHYW1lU3RhdHVzKGdhbWVTdGF0dXMpIHtcbiAgcmV0dXJuIGdhbWVTdGF0dXM7XG59XG5cblxuZnVuY3Rpb24gcGxheUdhbWVIZWxwZXIoY3VycmVudFBsYXllciwgb3Bwb3NpbmdQbGF5ZXIsIHRpbGUsIHNxdWFyZSkge1xuICBsZXQgYXR0YWNrID0gY3VycmVudFBsYXllci5zZW5kQXR0YWNrKG9wcG9zaW5nUGxheWVyLmdhbWVCb2FyZCwgc3F1YXJlKTtcbiAgaWYgKGF0dGFjayA9PSBcIm5vdHZhbGlkXCIpIHtcbiAgICBzaG93TWVzc2FnZShcIlRoYXQgbW92ZSBpcyBub3QgdmFsaWQuIFBsZWFzZSBwaWNrIGFub3RoZXIgdGlsZS5cIik7XG4gICAgcmV0dXJuIFwibm90dmFsaWRcIjtcbiAgfVxuICBpZiAoYXR0YWNrLmF0dGFja1N0YXR1cyA9PSB0cnVlKSB7XG4gICAgdGlsZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImdyZWVuXCI7XG4gICAgc2hvd01lc3NhZ2UoXCJcIik7XG4gIH0gZWxzZSBpZiAoYXR0YWNrID09IGZhbHNlKSB7XG4gICAgdGlsZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgIHNob3dNZXNzYWdlKFwiXCIpO1xuICB9XG4gIGlmIChhdHRhY2suc2hpcFN0YXR1cyA9PSB0cnVlKSB7XG4gICAgc2hvd01lc3NhZ2UoXCJBIHNoaXAgYmVjb21lcyBmZWFzdCBmb3IgdGhlIGZpc2hlcyFcIik7XG4gIH1cbiAgZ2FtZVN0YXR1cyA9IGdhbWVPdmVyKG9wcG9zaW5nUGxheWVyKTtcbn1cblxuZnVuY3Rpb24gcGxheUdhbWUoY3VycmVudFBsYXllciwgYm9hcmRPbmUsIGJvYXJkVHdvKSB7XG4gIGRpc2FibGVTZWxmQ2xpY2tzKGN1cnJlbnRQbGF5ZXIsIGJvYXJkT25lLCBib2FyZFR3byk7XG4gIGxldCBjb29yZGluYXRlcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImdhbWVTcXVhcmVcIikpO1xuICBjb29yZGluYXRlcy5mb3JFYWNoKCh0aWxlKSA9PiB7XG4gICAgdGlsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNxdWFyZSA9IHRpbGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcbiAgICAgIGlmIChjdXJyZW50UGxheWVyID09IHBsYXllck9uZSkge1xuICAgICAgICBsZXQgbW92ZSA9IHBsYXlHYW1lSGVscGVyKGN1cnJlbnRQbGF5ZXIsIHBsYXllclR3bywgdGlsZSwgc3F1YXJlKTtcbiAgICAgICAgaWYgKG1vdmUgIT0gXCJub3R2YWxpZFwiKSB7XG4gICAgICAgICAgY3VycmVudFBsYXllciA9IHBsYXllclR3bztcbiAgICAgICAgICBkaXNhYmxlU2VsZkNsaWNrcyhjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pO1xuICAgICAgICAgIHBsYXlHYW1lKGN1cnJlbnRQbGF5ZXIsIGJvYXJkT25lLCBib2FyZFR3byk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoZWNrR2FtZVN0YXR1cyhnYW1lU3RhdHVzKSA9PSB0cnVlKSB7XG4gICAgICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyT25lKSB7XG4gICAgICAgICAgICBzaG93R2FtZU92ZXIocGxheWVyT25lTmFtZS50ZXh0Q29udGVudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNob3dHYW1lT3ZlcihcIkNvbXB1dGVyXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyVHdvKSB7XG4gICAgbGV0IHJhbmRvbVNxdWFyZSA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDk5KTtcbiAgICBsZXQgcmFuZG9tVGlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWlkPVwiJHtyYW5kb21TcXVhcmV9XCJdYCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBsZXQgbW92ZSA9IHBsYXlHYW1lSGVscGVyKFxuICAgICAgICBjdXJyZW50UGxheWVyLFxuICAgICAgICBwbGF5ZXJPbmUsXG4gICAgICAgIHJhbmRvbVRpbGUsXG4gICAgICAgIHJhbmRvbVNxdWFyZVxuICAgICAgKTtcbiAgICAgIHdoaWxlIChtb3ZlID09ICdub3R2YWxpZCcpIHtcbiAgICAgICAgbGV0IHJhbmRvbVNxdWFyZSA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDk5KTtcbiAgICAgICAgbGV0IHJhbmRvbVRpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1pZD1cIiR7cmFuZG9tU3F1YXJlfVwiXWApO1xuICAgICAgICBtb3ZlID0gcGxheUdhbWVIZWxwZXIoXG4gICAgICAgICAgY3VycmVudFBsYXllcixcbiAgICAgICAgICBwbGF5ZXJPbmUsXG4gICAgICAgICAgcmFuZG9tVGlsZSxcbiAgICAgICAgICByYW5kb21TcXVhcmUpXG4gICAgICB9XG4gICAgICBpZiAobW92ZSAhPSBcIm5vdHZhbGlkXCIpIHtcbiAgICAgICAgY3VycmVudFBsYXllciA9IHBsYXllck9uZTtcbiAgICAgICAgZGlzYWJsZVNlbGZDbGlja3MoY3VycmVudFBsYXllciwgYm9hcmRPbmUsIGJvYXJkVHdvKTtcbiAgICAgIH1cbiAgICB9LCA3MDApO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIHBsYXllck9uZSxcbiAgcGxheWVyVHdvLFxuICBwbGF5R2FtZSxcbiAgZ2FtZU92ZXIsXG4gIGNoZWNrR2FtZVN0YXR1cyxcbiAgZ2FtZVN0YXR1cyxcbn07XG4iLCJpbXBvcnQge1xuICBjcmVhdGVHYW1lQm9hcmQsXG4gIHNob3dTZWxlY3Rpb25TY3JlZW4sXG4gIHNob3dTZWxlY3RCb2FyZCxcbiAgc2hvd0dhbWVCb2FyZCxcbiAgYWRkUGxheWVyTmFtZSxcbiAgbmV3R2FtZSxcbiAgc2hvd0dhbWVPdmVyLFxufSBmcm9tIFwiLi9kb21cIjtcbmltcG9ydCB7XG4gIHBsYXllck9uZSxcbiAgcGxheWVyVHdvLFxuICBwbGF5R2FtZSxcbn0gZnJvbSBcIi4vZ2FtZWxvZ2ljXCI7XG5pbXBvcnQgeyBhbGxvd0RyYWcsIGFsbG93RHJvcCwgY2hlY2tQb3NpdGlvbnMgfSBmcm9tIFwiLi9kcmFnYW5kZHJvcFwiO1xuXG5jb25zdCBib2FyZE9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRPbmVcIik7XG5jb25zdCBib2FyZFR3byA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRUd29cIik7XG5jb25zdCBwcmVwYXJlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXBhcmVCdXR0b24nKVxuY29uc3QgYmVnaW5CdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJlZ2luQnV0dG9uXCIpO1xuY29uc3QgcGxheWVyT25lTmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyT25lTmFtZVwiKTtcbmNvbnN0IG5ld0dhbWVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5ld0dhbWVCdXR0b25cIik7XG5sZXQgcGxheWVyTmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5ZXJOYW1lXCIpO1xubGV0IGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXJPbmU7XG5cbmxldCBwbGF5ZXJOYW1lID0gXCJcIjtcbnBsYXllck5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICBwbGF5ZXJOYW1lID0gcGxheWVyTmFtZUlucHV0LnZhbHVlO1xufSk7XG5cbnByZXBhcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgc2hvd1NlbGVjdGlvblNjcmVlbigpO1xuICBzaG93U2VsZWN0Qm9hcmQoKTtcbiAgYWxsb3dEcmFnKCk7XG4gIGFsbG93RHJvcCgpO1xuICBjaGVja1Bvc2l0aW9ucygpO1xufSk7XG5cbmJlZ2luQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIHNob3dHYW1lQm9hcmQoKTtcbiAgYWRkUGxheWVyTmFtZShwbGF5ZXJPbmVOYW1lLCBwbGF5ZXJOYW1lKTtcbiAgY3JlYXRlR2FtZUJvYXJkKHBsYXllck9uZSwgYm9hcmRPbmUpO1xuICBjcmVhdGVHYW1lQm9hcmQocGxheWVyVHdvLCBib2FyZFR3byk7XG59KVxuXG5iZWdpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBwbGF5R2FtZShjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pO1xufSk7XG5cblxubmV3R2FtZUJ1dHRvbi5vbmNsaWNrID0gbmV3R2FtZTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVHYW1lQm9hcmQiLCJwbGF5ZXIiLCJib2FyZCIsImkiLCJnYW1lQm9hcmQiLCJsZW5ndGgiLCJnYW1lU3F1YXJlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwicGxheWVyTmFtZSIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwibmV3R2FtZSIsImxvY2F0aW9uIiwicmVsb2FkIiwic2hvd01lc3NhZ2UiLCJtZXNzYWdlIiwiZ2V0RWxlbWVudEJ5SWQiLCJ0ZXh0Q29udGVudCIsImdhbWVCb2FyZEZhY3RvcnkiLCJtaXNzZWRBdHRhY2tzIiwic3VjY2Vzc2Z1bEF0dGFja3MiLCJzdW5rU2hpcHMiLCJwbGFjZVNoaXAiLCJuYW1lT2ZTaGlwIiwiY29vcmRpbmF0ZXMiLCJuZXdTaGlwIiwid2hlcmVIaXQiLCJoaXQiLCJudW1iZXIiLCJwYXJzZUludCIsImluY2x1ZGVzIiwicHVzaCIsImlzU3VuayIsInN1bmtTdGF0dXMiLCJ0aGlzIiwic2hpcEZhY3RvcnkiLCJmb3JFYWNoIiwiY29vcmRpbmF0ZSIsInJlY2VpdmVBdHRhY2siLCJhdHRhY2tTdGF0dXMiLCJzaGlwU3RhdHVzIiwicmVwb3J0IiwibWFwIiwidGlsZSIsInBsYXllckZhY3RvcnkiLCJwbGF5ZXJUeXBlIiwic2VuZEF0dGFjayIsInVuZGVmaW5lZCIsImdldFJhbmRvbUNvb3JkaW5hdGVzIiwibWluIiwibWF4IiwiTWF0aCIsImNlaWwiLCJmbG9vciIsInJhbmRvbSIsImRyYWdnYWJsZVNoaXBzIiwiQXJyYXkiLCJmcm9tIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImFjdGl2YXRlRHJvcCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJzaG93SG92ZXJDb2xvciIsInRhcmdldCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwicmVtb3ZlSG92ZXJDb2xvciIsImRyYWciLCJlIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImdldEF0dHJpYnV0ZSIsImRyb3AiLCJkYXRhIiwiZ2V0RGF0YSIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRQb3NpdGlvbnMiLCJib3hlc1dpdGhTaGlwcyIsImZpbHRlciIsImJveCIsImhhc0NoaWxkTm9kZXMiLCJib3hJRCIsInNoaXBJRCIsImZpcnN0Q2hpbGQiLCJpZCIsImNyZWF0ZVNoaXBDb29yZGluYXRlcyIsInNoaXAiLCJOdW1iZXIiLCJwbGF5ZXJPbmUiLCJiZWdpbkJ1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJwb3NpdGlvbnMiLCJzaGlwcyIsImJveGVzIiwic2hpcE9uZSIsInNoaXBUd28iLCJzaGlwVGhyZWUiLCJzaGlwRm91ciIsInNoaXBGaXZlIiwiY3JlYXRlU2hpcHMiLCJjb21wdXRlckNvb3JkaW5hdGVzIiwiZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiIsInRvU3RyaW5nIiwiZmlyc3RTaGlwQ29vcmRpbmF0ZXMiLCJzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiIsInNlY29uZFNoaXBDb29yZGluYXRlcyIsInRoaXJkU2hpcEZpcnN0UG9zaXRpb24iLCJ0aGlyZFNoaXBDb29yZGluYXRlcyIsImZvdXJ0aFNoaXBGaXJzdFBvc2l0aW9uIiwiZm91cnRoU2hpcENvb3JkaW5hdGVzIiwiZmlmdGhTaGlwRmlyc3RQb3NpdGlvbiIsImZpZnRoU2hpcENvb3JkaW5hdGVzIiwiY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlcyIsInBsYXllclR3byIsImNvbnNvbGUiLCJsb2ciLCJnYW1lU3RhdHVzIiwiZGlzYWJsZVNlbGZDbGlja3MiLCJjdXJyZW50UGxheWVyIiwiYm9hcmRPbmUiLCJib2FyZFR3byIsInBvaW50ZXJFdmVudHMiLCJwbGF5R2FtZUhlbHBlciIsIm9wcG9zaW5nUGxheWVyIiwic3F1YXJlIiwiYXR0YWNrIiwiZ2FtZU92ZXIiLCJwbGF5R2FtZSIsImdhbWVPdmVyQ29udGFpbmVyIiwicmVtb3ZlIiwiZGlzcGxheVdpbm5lclRleHQiLCJpbm5lclRleHQiLCJuZXdHYW1lQnV0dG9uIiwib25jbGljayIsInNob3dHYW1lT3ZlciIsInBsYXllck9uZU5hbWUiLCJyYW5kb21TcXVhcmUiLCJyYW5kb21UaWxlIiwic2V0VGltZW91dCIsIm1vdmUiLCJwcmVwYXJlQnV0dG9uIiwicGxheWVyTmFtZUlucHV0IiwidmFsdWUiLCJzZWxlY3RCb2FyZCIsInNob3dTZWxlY3RCb2FyZCIsImFkZFBsYXllck5hbWUiXSwic291cmNlUm9vdCI6IiJ9