(()=>{"use strict";function e(e,t){for(let n=0;n<e.gameBoard.board.length;n++){let a=document.createElement("div");a.classList.add("gameSquare"),a.classList.add(e.playerName),a.setAttribute("data-id",n),t.appendChild(a)}}function t(){location.reload()}function n(e){document.getElementById("mainContainer").classList.add("hidden");const n=document.getElementById("gameOverContainer");n.classList.remove("hidden");let a=document.createElement("h1");a.innerText=`The game is over. ${e} has won!`,n.appendChild(a);const r=document.createElement("button");r.textContent="Start New Game",r.classList.add("newgame"),r.onclick=t,n.appendChild(r)}function a(e){document.getElementById("message").textContent=e}const r=()=>{let e=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],t=[],n=[],a=0;return{board:e,sunkShips:a,successfulAttacks:n,missedAttacks:t,placeShip:function(t,n,a){let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const r=e=>(e=parseInt(e),!!n.includes(e)&&(a.push(e),!0)),i=function(e){return t==a.length?(e=!0,this.sunkStatus=e,e):(e=!1,this.sunkStatus=e,e)};return{nameOfShip:e,length:t,coordinates:n,whereHit:a,sunkStatus:arguments.length>4&&void 0!==arguments[4]&&arguments[4],hit:r,isSunk:i}}(t,n,a);a.forEach((t=>{e[t].push(r)}))},receiveAttack:function(r){if(""!=e[r]){n.push(r);let t=e[r][0].hit(r),i=e[r][0].isSunk();return 1==i&&(a+=1),{attackStatus:t,shipStatus:i}}return t.push(r),!1},report:function(){return e.map((e=>{if(""!=e)return e[0].isSunk(),1==e[0].sunkStatus})).includes(!1)?"There are still alive ships":"All ships have sunk!"}}},i=function(e,t){return{playerName:e,sendAttack:function(e,t){let n="valid";return(e.missedAttacks.includes(t)||null!=e.successfulAttacks&&e.successfulAttacks.includes(t))&&(n="notValid"),"valid"==n?e.receiveAttack(t):"notvalid"},gameBoard:r()}};function o(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}const s=Array.from(document.getElementsByClassName("draggable"));function d(e){e.preventDefault()}function l(e){e.target.style.backgroundColor="aqua"}function c(e){e.target.style.backgroundColor=null}function u(e){e.dataTransfer.setData("text",e.target.getAttribute("id"))}function m(e){e.preventDefault();let t=e.dataTransfer.getData("text"),n=e.target;c(e),n.appendChild(document.querySelector(`[id="${t}"]`))}function h(){let e=Array.from(document.getElementsByClassName("droppable")).filter((e=>{if(e.hasChildNodes())return e}));return{boxID:e.map((e=>e.getAttribute("set-id"))),shipID:e.map((e=>e.firstChild.id))}}function p(e,t){return t=Number(t),"carrier"==e?[t,t+1,t+2,t+3,t+4]:"battleship"==e?[t,t+1,t+2,t+3]:"cruiser"==e||"submarine"==e?[t,t+1,t+2]:"destroyer"==e?[t,t+1]:void 0}let g=i("playerOne");beginButton.addEventListener("click",(function(){let e=h(),t=function(e,t){return{shipOne:p(t[0],e[0]),shipTwo:p(t[1],e[1]),shipThree:p(t[2],e[2]),shipFour:p(t[3],e[3]),shipFive:p(t[4],e[4])}}(e.boxID,e.shipID);g.gameBoard.placeShip("carrier",t.shipOne.length,t.shipOne),g.gameBoard.placeShip("battleship",t.shipTwo.length,t.shipTwo),g.gameBoard.placeShip("submarine",t.shipThree.length,t.shipThree),g.gameBoard.placeShip("cruiser",t.shipFour.length,t.shipFour),g.gameBoard.placeShip("destroyer",t.shipFive.length,t.shipFive)}));let f=function(){let e=o(0,2).toString()+o(0,5).toString();e=Number(e);let t=[e,e+1,e+2,e+3,e+4],n=o(3,4).toString()+o(0,6).toString();n=Number(n);let a=[n,n+1,n+2,n+3],r=o(7,8).toString()+o(0,7).toString();r=Number(r);let i=[r,r+1,r+2],s="9"+o(0,7).toString();s=Number(s);let d=[s,s+1,s+2],l=o(5,6).toString()+o(0,7).toString();return l=Number(l),{firstShipCoordinates:t,secondShipCoordinates:a,thirdShipCoordinates:i,fourthShipCoordinates:d,fifthShipCoordinates:[l,l+1,l+2]}}();console.log(f);let v=i("playerTwo");v.gameBoard.placeShip("carrier",5,f.firstShipCoordinates),v.gameBoard.placeShip("battleship",4,f.secondShipCoordinates),v.gameBoard.placeShip("submarine",3,f.thirdShipCoordinates),v.gameBoard.placeShip("cruiser",3,f.fourthShipCoordinates),v.gameBoard.placeShip("destroyer",2,f.firstShipCoordinates);let S="";function y(e,t,n){e==g?(t.style.pointerEvents="none",n.style.pointerEvents="auto"):e==v&&(n.style.pointerEvents="none",t.style.pointerEvents="auto")}function E(e,t,n,r){let i=e.sendAttack(t.gameBoard,r);if("notvalid"==i)return a("That move is not valid. Please pick another tile."),"notvalid";1==i.attackStatus?(n.style.backgroundColor="green",a("")):0==i&&(n.style.backgroundColor="red",a("")),1==i.shipStatus&&a("A ship becomes feast for the fishes!"),S=function(e){return"All ships have sunk!"==e.gameBoard.report()}(t)}function B(e,t,n){if(y(e,t,n),Array.from(document.getElementsByClassName("gameSquare")).forEach((a=>{a.addEventListener("click",(function(){let r=a.getAttribute("data-id");e==g&&"notvalid"!=E(e,v,a,r)&&(y(e=v,t,n),B(e,t,n))}))})),e==v){let a=o(0,99),r=document.querySelector(`[data-id="${a}"]`);setTimeout((()=>{let i=E(e,g,r,a);for(;"notvalid"==i;){let t=o(0,99),n=document.querySelector(`[data-id="${t}"]`);i=E(e,g,n,t)}"notvalid"!=i&&y(e=g,t,n)}),700)}}const C=document.getElementById("boardOne"),b=document.getElementById("boardTwo"),k=document.getElementById("prepareButton"),L=document.getElementById("beginButton"),A=document.getElementById("playerOneName"),I=document.getElementById("newGameButton");let N=document.getElementById("playerName"),T=g,w="";N.addEventListener("input",(function(){w=N.value})),k.addEventListener("click",(function(){document.getElementById("welcomeScreenContainer").classList.add("hidden"),document.getElementById("selectScreenContainer").classList.remove("hidden"),function(){const e=document.getElementById("selectBoard");for(let t=0;t<100;t++){let n=document.createElement("div");n.classList.add("selectSquare"),n.classList.add("droppable"),n.setAttribute("set-id",t),e.appendChild(n)}}(),s.forEach((e=>{e.addEventListener("dragstart",u)})),Array.from(document.getElementsByClassName("droppable")).forEach((e=>{e.addEventListener("dragover",d),e.addEventListener("dragover",l),e.addEventListener("dragleave",c),e.addEventListener("drop",m)})),Array.from(document.getElementsByClassName("droppable")).forEach((e=>{e.addEventListener("drop",(function(){5==h().boxID.length&&document.getElementById("beginButton").classList.remove("hidden")}))}))})),L.addEventListener("click",(function(){document.getElementById("selectScreenContainer").classList.add("hidden"),document.getElementById("mainContainer").classList.remove("hidden"),function(e,t){e.textContent=""!=t?t:"Anonymous Challenger's Board"}(A,w),e(g,C),e(v,b)})),L.addEventListener("click",(function(){B(T,C,b),Array.from(document.getElementsByClassName("gameSquare")).forEach((e=>{e.addEventListener("click",(function(){1==S&&n(T==g?A.textContent:"Computer")}))}))})),document.getElementById("gameOverButton").onclick=n,I.onclick=t})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFZQyxpQkFBaUIsU0FBUyxXTGpCTjlGLFNBQVNZLGVBQ3JDLHlCQUVvQlYsVUFBVUMsSUFBSSxVQUNkSCxTQUFTWSxlQUFlLGlCQUNoQ1YsVUFBVVksT0FBTyxVQWFqQyxTQUF1QnBCLEVBQVFVLEdBRTNCVixFQUFPd0IsWUFEUyxJQUFkZCxFQUNtQkEsRUFFQSw4QkFFeEIsQ0tMQ3lJLENBQWNMLEVBQWVwSSxHQUM3QlgsRUFBZ0JtRyxFQUFXOEIsR0FDM0JqSSxFQUFnQjhILEVBQVdJLEVBQzVCLElBRUQ5QixFQUFZQyxpQkFBaUIsU0FBUyxXQUNwQ29DLEVBQVN2SCxFQUFlK0csRUFBVUMsR0FDaEIvRCxNQUFNQyxLQUFLN0QsU0FBUzhELHVCQUF1QixlQUNqRHRCLFNBQVNPLElBQ25CQSxFQUFLK0MsaUJBQWlCLFNBQVMsV0FDTSxHQUFmMEIsR0FFaEI5RyxFQURFQyxHQUFpQmlGLEVBQ040QyxFQUFjdEgsWUFFZCxXQUdsQixHQVJELEdBVUgsSUFFc0JsQixTQUFTWSxlQUFlLGtCQUVoQ08sUUFBVVQsRUFFekJPLEVBQWNFLFFBQVVaLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2ZhY3RvcnlGdW5jdGlvbnMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jb21wdXRlcmNvb3JkaW5hdGVzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZHJhZ2FuZGRyb3AuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lbG9naWMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBzaG93U2VsZWN0aW9uU2NyZWVuKCkge1xuICBjb25zdCB3ZWxjb21lU2NyZWVuQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgXCJ3ZWxjb21lU2NyZWVuQ29udGFpbmVyXCJcbiAgKTtcbiAgd2VsY29tZVNjcmVlbkNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICBjb25zdCBzZWxlY3RTY3JlZW5Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICBcInNlbGVjdFNjcmVlbkNvbnRhaW5lclwiXG4gICk7XG4gIHNlbGVjdFNjcmVlbkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xufVxuXG5mdW5jdGlvbiBzaG93U2VsZWN0Qm9hcmQoKSB7XG4gIGNvbnN0IHNlbGVjdEJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWxlY3RCb2FyZFwiKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgIGxldCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RTcXVhcmUnKTtcbiAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZCgnZHJvcHBhYmxlJyk7XG4gICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInNldC1pZFwiLCBpKTtcbiAgICBzZWxlY3RCb2FyZC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNob3dHYW1lQm9hcmQoKSB7XG4gIGNvbnN0IHNlbGVjdFNjcmVlbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgIFwic2VsZWN0U2NyZWVuQ29udGFpbmVyXCJcbiAgKTtcbiAgc2VsZWN0U2NyZWVuQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gIGNvbnN0IG1haW5Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1haW5Db250YWluZXJcIik7XG4gIG1haW5Db250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlR2FtZUJvYXJkKHBsYXllciwgYm9hcmQpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbGF5ZXIuZ2FtZUJvYXJkLmJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IGdhbWVTcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGdhbWVTcXVhcmUuY2xhc3NMaXN0LmFkZChcImdhbWVTcXVhcmVcIik7XG4gICAgZ2FtZVNxdWFyZS5jbGFzc0xpc3QuYWRkKHBsYXllci5wbGF5ZXJOYW1lKTtcbiAgICBnYW1lU3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgaSk7XG4gICAgYm9hcmQuYXBwZW5kQ2hpbGQoZ2FtZVNxdWFyZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYWRkUGxheWVyTmFtZShwbGF5ZXIsIHBsYXllck5hbWUpIHtcbiAgaWYgKHBsYXllck5hbWUgIT0gXCJcIikge1xuICAgIHBsYXllci50ZXh0Q29udGVudCA9IHBsYXllck5hbWU7XG4gIH0gZWxzZSB7XG4gICAgcGxheWVyLnRleHRDb250ZW50ID0gXCJBbm9ueW1vdXMgQ2hhbGxlbmdlcidzIEJvYXJkXCI7XG4gIH1cbn1cblxuZnVuY3Rpb24gbmV3R2FtZSgpIHtcbiAgbG9jYXRpb24ucmVsb2FkKCk7XG59XG5cbmZ1bmN0aW9uIHNob3dHYW1lT3ZlcihjdXJyZW50UGxheWVyKSB7XG4gIGNvbnN0IG1haW5Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1haW5Db250YWluZXJcIik7XG4gIG1haW5Db250YWluZXIuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgY29uc3QgZ2FtZU92ZXJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVPdmVyQ29udGFpbmVyXCIpO1xuICBnYW1lT3ZlckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKVxuICBsZXQgZGlzcGxheVdpbm5lclRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDFcIik7XG4gIGRpc3BsYXlXaW5uZXJUZXh0LmlubmVyVGV4dCA9IGBUaGUgZ2FtZSBpcyBvdmVyLiAke2N1cnJlbnRQbGF5ZXJ9IGhhcyB3b24hYDtcbiAgZ2FtZU92ZXJDb250YWluZXIuYXBwZW5kQ2hpbGQoZGlzcGxheVdpbm5lclRleHQpO1xuICBjb25zdCBuZXdHYW1lQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgbmV3R2FtZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3RhcnQgTmV3IEdhbWVcIjtcbiAgbmV3R2FtZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibmV3Z2FtZVwiKTtcbiAgbmV3R2FtZUJ1dHRvbi5vbmNsaWNrID0gbmV3R2FtZTtcbiAgZ2FtZU92ZXJDb250YWluZXIuYXBwZW5kQ2hpbGQobmV3R2FtZUJ1dHRvbik7XG59XG5cbmZ1bmN0aW9uIHNob3dNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgY29uc3QgbWVzc2FnZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVzc2FnZVwiKTtcbiAgbWVzc2FnZUNvbnRhaW5lci50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG59XG5cbmV4cG9ydCB7XG4gIGNyZWF0ZUdhbWVCb2FyZCxcbiAgc2hvd1NlbGVjdGlvblNjcmVlbixcbiAgc2hvd1NlbGVjdEJvYXJkLFxuICBzaG93R2FtZUJvYXJkLFxuICBhZGRQbGF5ZXJOYW1lLFxuICBuZXdHYW1lLFxuICBzaG93R2FtZU92ZXIsXG4gIHNob3dNZXNzYWdlLFxufTtcbiIsImNvbnN0IHNoaXBGYWN0b3J5ID0gKFxuICBuYW1lT2ZTaGlwLFxuICBsZW5ndGgsXG4gIGNvb3JkaW5hdGVzID0gW10sXG4gIHdoZXJlSGl0ID0gW10sXG4gIHN1bmtTdGF0dXMgPSBmYWxzZVxuKSA9PiB7XG4gIGNvbnN0IGhpdCA9IChudW1iZXIpID0+IHtcbiAgICBudW1iZXIgPSBwYXJzZUludChudW1iZXIpXG4gICBpZiAoY29vcmRpbmF0ZXMuaW5jbHVkZXMobnVtYmVyKSkge1xuICAgICAgICB3aGVyZUhpdC5wdXNoKG51bWJlcik7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICB9O1xuICBjb25zdCBpc1N1bmsgPSBmdW5jdGlvbiAoc3Vua1N0YXR1cykge1xuICAgIGlmIChsZW5ndGggPT0gd2hlcmVIaXQubGVuZ3RoKSB7XG4gICAgICBzdW5rU3RhdHVzID0gdHJ1ZTtcbiAgICAgIHRoaXMuc3Vua1N0YXR1cyA9IHN1bmtTdGF0dXNcbiAgICAgIHJldHVybiBzdW5rU3RhdHVzO1xuICAgIH0gZWxzZSB7XG4gICAgc3Vua1N0YXR1cyA9IGZhbHNlO1xuICAgIHRoaXMuc3Vua1N0YXR1cyA9IHN1bmtTdGF0dXNcbiAgICByZXR1cm4gc3Vua1N0YXR1cztcbiAgfX07XG4gIHJldHVybiB7IG5hbWVPZlNoaXAsIGxlbmd0aCwgY29vcmRpbmF0ZXMsIHdoZXJlSGl0LCBzdW5rU3RhdHVzLCBoaXQsIGlzU3VuayB9O1xufTtcblxuXG4vL2dhbWVCb2FyZCBpcyAxMHgxMFxuXG5jb25zdCBnYW1lQm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICBsZXQgYm9hcmQgPSBbXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sXG4gICAgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW10sIFtdLCBbXSwgW11cbiAgXVxuICBsZXQgbWlzc2VkQXR0YWNrcyA9IFtdXG4gIGxldCBzdWNjZXNzZnVsQXR0YWNrcyA9IFtdXG4gIGxldCBzdW5rU2hpcHMgPSAwXG4gIGNvbnN0IHBsYWNlU2hpcCA9IGZ1bmN0aW9uIChuYW1lT2ZTaGlwLCBsZW5ndGgsIGNvb3JkaW5hdGVzKSB7XG4gICAgbGV0IG5ld1NoaXAgPSBzaGlwRmFjdG9yeShuYW1lT2ZTaGlwLCBsZW5ndGgsIGNvb3JkaW5hdGVzKTtcbiAgICBjb29yZGluYXRlcy5mb3JFYWNoKGNvb3JkaW5hdGUgPT4ge1xuICAgICAgYm9hcmRbY29vcmRpbmF0ZV0ucHVzaChuZXdTaGlwKVxuICAgIH0pXG4gICAgfVxuICA7XG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSBmdW5jdGlvbihudW1iZXIpIHtcbiAgICBpZiAoYm9hcmRbbnVtYmVyXSAhPSBcIlwiKSB7XG4gICAgICBzdWNjZXNzZnVsQXR0YWNrcy5wdXNoKG51bWJlcik7XG4gICAgICBsZXQgYXR0YWNrU3RhdHVzID0gYm9hcmRbbnVtYmVyXVswXS5oaXQobnVtYmVyKTtcbiAgICAgIGxldCBzaGlwU3RhdHVzID0gYm9hcmRbbnVtYmVyXVswXS5pc1N1bmsoKVxuICAgICAgaWYgKHNoaXBTdGF0dXMgPT0gdHJ1ZSkge1xuICAgICAgICBzdW5rU2hpcHMgKz0gMVxuICAgICAgfVxuICAgICAgcmV0dXJuIHthdHRhY2tTdGF0dXMsIHNoaXBTdGF0dXN9XG4gICAgfSBlbHNlIHsgICAgICBcbiAgICAgIG1pc3NlZEF0dGFja3MucHVzaChudW1iZXIpO1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSBcbiAgfTtcbiAgY29uc3QgcmVwb3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgbGV0IGNoZWNrU3RhdHVzID0gYm9hcmQubWFwKCh0aWxlKSA9PiB7XG4gICAgICBpZiAodGlsZSAhPSAnJykge1xuICAgICAgICB0aWxlWzBdLmlzU3VuaygpXG4gICAgICBpZiAodGlsZVswXS5zdW5rU3RhdHVzID09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgICBpZiAoY2hlY2tTdGF0dXMuaW5jbHVkZXMoZmFsc2UpKSB7XG4gICAgICByZXR1cm4gXCJUaGVyZSBhcmUgc3RpbGwgYWxpdmUgc2hpcHNcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwiQWxsIHNoaXBzIGhhdmUgc3VuayFcIjtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHsgYm9hcmQsIHN1bmtTaGlwcywgc3VjY2Vzc2Z1bEF0dGFja3MsIG1pc3NlZEF0dGFja3MsIHBsYWNlU2hpcCwgcmVjZWl2ZUF0dGFjaywgcmVwb3J0IH07XG59O1xuXG4vL3BsYXllciBGYWN0b3J5XG5cblxuY29uc3QgcGxheWVyRmFjdG9yeSA9IGZ1bmN0aW9uKHBsYXllck5hbWUsIHBsYXllclR5cGUpIHtcbiAgY29uc3QgZ2FtZUJvYXJkID0gZ2FtZUJvYXJkRmFjdG9yeSgpOyAgIFxuICAgIGNvbnN0IHNlbmRBdHRhY2sgPSBmdW5jdGlvbihib2FyZCwgY29vcmRpbmF0ZSkge1xuICAgICAgbGV0IGF0dGFja1N0YXR1cyA9ICd2YWxpZCdcbiAgICAgIGlmIChib2FyZC5taXNzZWRBdHRhY2tzLmluY2x1ZGVzKGNvb3JkaW5hdGUpKSB7XG4gICAgICAgICAgYXR0YWNrU3RhdHVzID0gJ25vdFZhbGlkJ1xuICAgICAgICB9IGVsc2UgaWYgKGJvYXJkLnN1Y2Nlc3NmdWxBdHRhY2tzICE9IHVuZGVmaW5lZCAmJiBib2FyZC5zdWNjZXNzZnVsQXR0YWNrcy5pbmNsdWRlcyhjb29yZGluYXRlKSkge1xuICAgICAgICAgIGF0dGFja1N0YXR1cyA9ICdub3RWYWxpZCdcbiAgICAgICB9XG4gICAgICAgaWYgKGF0dGFja1N0YXR1cyA9PSAndmFsaWQnKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpXG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ25vdHZhbGlkJ1xuICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtwbGF5ZXJOYW1lLCBzZW5kQXR0YWNrLCBnYW1lQm9hcmR9XG59XG5cbmV4cG9ydCB7IGdhbWVCb2FyZEZhY3RvcnksIHBsYXllckZhY3RvcnksIHNoaXBGYWN0b3J5IH07XG4iLCJmdW5jdGlvbiBnZXRSYW5kb21Db29yZGluYXRlcyhtaW4sIG1heCkge1xuICBtaW4gPSBNYXRoLmNlaWwobWluKTtcbiAgbWF4ID0gTWF0aC5mbG9vcihtYXgpO1xuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDb21wdXRlckNvb3JkaW5hdGVzKCkge1xuICBsZXQgZmlyc3RTaGlwRmlyc3ROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCAyKS50b1N0cmluZygpO1xuICBsZXQgZmlyc3RTaGlwU2Vjb25kTnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoMCwgNSkudG9TdHJpbmcoKTtcbiAgbGV0IGZpcnN0U2hpcEZpcnN0UG9zaXRpb24gPSBmaXJzdFNoaXBGaXJzdE51bWJlciArIGZpcnN0U2hpcFNlY29uZE51bWJlcjtcbiAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiA9IE51bWJlcihmaXJzdFNoaXBGaXJzdFBvc2l0aW9uKTtcbiAgbGV0IGZpcnN0U2hpcENvb3JkaW5hdGVzID0gW1xuICAgIGZpcnN0U2hpcEZpcnN0UG9zaXRpb24sXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDEsXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDIsXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDMsXG4gICAgZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiArIDQsXG4gIF07XG4gIGxldCBzZWNvbmRTaGlwRmlyc3ROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcygzLCA0KS50b1N0cmluZygpO1xuICBsZXQgc2Vjb25kU2hpcFNlY29uZE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDYpLnRvU3RyaW5nKCk7XG4gIGxldCBzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiA9IHNlY29uZFNoaXBGaXJzdE51bWJlciArIHNlY29uZFNoaXBTZWNvbmROdW1iZXI7XG4gIHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uID0gTnVtYmVyKHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uKTtcbiAgbGV0IHNlY29uZFNoaXBDb29yZGluYXRlcyA9IFtcbiAgICBzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbixcbiAgICBzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiArIDEsXG4gICAgc2Vjb25kU2hpcEZpcnN0UG9zaXRpb24gKyAyLFxuICAgIHNlY29uZFNoaXBGaXJzdFBvc2l0aW9uICsgMyxcbiAgXTtcbiAgbGV0IHRoaXJkU2hpcEZpcnN0TnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoNywgOCkudG9TdHJpbmcoKTtcbiAgbGV0IHRoaXJkU2hpcFNlY29uZE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDcpLnRvU3RyaW5nKCk7XG4gIGxldCB0aGlyZFNoaXBGaXJzdFBvc2l0aW9uID0gdGhpcmRTaGlwRmlyc3ROdW1iZXIgKyB0aGlyZFNoaXBTZWNvbmROdW1iZXI7XG4gIHRoaXJkU2hpcEZpcnN0UG9zaXRpb24gPSBOdW1iZXIodGhpcmRTaGlwRmlyc3RQb3NpdGlvbik7XG4gIGxldCB0aGlyZFNoaXBDb29yZGluYXRlcyA9IFtcbiAgICB0aGlyZFNoaXBGaXJzdFBvc2l0aW9uLFxuICAgIHRoaXJkU2hpcEZpcnN0UG9zaXRpb24gKyAxLFxuICAgIHRoaXJkU2hpcEZpcnN0UG9zaXRpb24gKyAyLFxuICBdO1xuICBsZXQgZm91cnRoU2hpcEZpcnN0TnVtYmVyID0gXCI5XCJcbiAgbGV0IGZvdXJ0aFNoaXBTZWNvbmROdW1iZXIgPSBnZXRSYW5kb21Db29yZGluYXRlcygwLCA3KS50b1N0cmluZygpO1xuICBsZXQgZm91cnRoU2hpcEZpcnN0UG9zaXRpb24gPSBmb3VydGhTaGlwRmlyc3ROdW1iZXIgKyBmb3VydGhTaGlwU2Vjb25kTnVtYmVyO1xuICBmb3VydGhTaGlwRmlyc3RQb3NpdGlvbiA9IE51bWJlcihmb3VydGhTaGlwRmlyc3RQb3NpdGlvbik7XG4gIGxldCBmb3VydGhTaGlwQ29vcmRpbmF0ZXMgPSBbXG4gICAgZm91cnRoU2hpcEZpcnN0UG9zaXRpb24sXG4gICAgZm91cnRoU2hpcEZpcnN0UG9zaXRpb24gKyAxLFxuICAgIGZvdXJ0aFNoaXBGaXJzdFBvc2l0aW9uICsgMixcbiAgXTtcbiAgbGV0IGZpZnRoU2hpcEZpcnN0TnVtYmVyID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoNSwgNikudG9TdHJpbmcoKTtcbiAgbGV0IGZpZnRoU2hpcFNlY29uZE51bWJlciA9IGdldFJhbmRvbUNvb3JkaW5hdGVzKDAsIDcpLnRvU3RyaW5nKCk7XG4gIGxldCBmaWZ0aFNoaXBGaXJzdFBvc2l0aW9uID0gZmlmdGhTaGlwRmlyc3ROdW1iZXIgKyBmaWZ0aFNoaXBTZWNvbmROdW1iZXI7XG4gIGZpZnRoU2hpcEZpcnN0UG9zaXRpb24gPSBOdW1iZXIoZmlmdGhTaGlwRmlyc3RQb3NpdGlvbik7XG4gIGxldCBmaWZ0aFNoaXBDb29yZGluYXRlcyA9IFtmaWZ0aFNoaXBGaXJzdFBvc2l0aW9uLCBmaWZ0aFNoaXBGaXJzdFBvc2l0aW9uICsgMSwgZmlmdGhTaGlwRmlyc3RQb3NpdGlvbiArIDJdO1xuICByZXR1cm4ge2ZpcnN0U2hpcENvb3JkaW5hdGVzLCBzZWNvbmRTaGlwQ29vcmRpbmF0ZXMsIHRoaXJkU2hpcENvb3JkaW5hdGVzLCBmb3VydGhTaGlwQ29vcmRpbmF0ZXMsIGZpZnRoU2hpcENvb3JkaW5hdGVzfVxufVxuXG5leHBvcnQge2dldFJhbmRvbUNvb3JkaW5hdGVzLCBjcmVhdGVDb21wdXRlckNvb3JkaW5hdGVzfVxuIiwiY29uc3QgZHJhZ2dhYmxlU2hpcHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2RyYWdnYWJsZScpKSBcblxuZnVuY3Rpb24gYWN0aXZhdGVEcm9wKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn1cblxuZnVuY3Rpb24gc2hvd0hvdmVyQ29sb3IoZXZlbnQpIHtcbiAgICBldmVudC50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2FxdWEnXG59XG5cbmZ1bmN0aW9uIHJlbW92ZUhvdmVyQ29sb3IoZXZlbnQpe1xuICAgIGV2ZW50LnRhcmdldC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBudWxsXG59XG5cbmZ1bmN0aW9uIGRyYWcoZSkge1xuICAgIGUuZGF0YVRyYW5zZmVyLnNldERhdGEoJ3RleHQnLCBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2lkJykpXG59XG5cbmZ1bmN0aW9uIGRyb3AoZSl7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGxldCBkYXRhID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgndGV4dCcpXG4gICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0XG4gICAgcmVtb3ZlSG92ZXJDb2xvcihlKVxuICAgdGFyZ2V0LmFwcGVuZENoaWxkKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtpZD1cIiR7ZGF0YX1cIl1gKSlcbn1cblxuXG5sZXQgYWxsb3dEcmFnID0gZnVuY3Rpb24oKSB7XG4gICAgZHJhZ2dhYmxlU2hpcHMuZm9yRWFjaChzaGlwID0+IHtcbiAgICBzaGlwLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGRyYWcpXG59KVxufVxuXG5sZXQgYWxsb3dEcm9wID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc3Qgc2VsZWN0Qm94ZXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2Ryb3BwYWJsZScpKVxuICAgIHNlbGVjdEJveGVzLmZvckVhY2goYm94ID0+IHtcbiAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCBhY3RpdmF0ZURyb3ApXG4gICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgc2hvd0hvdmVyQ29sb3IpXG4gICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdsZWF2ZScsIHJlbW92ZUhvdmVyQ29sb3IpXG4gICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBkcm9wKVxufSlcbn1cblxuZnVuY3Rpb24gZ2V0UG9zaXRpb25zKCl7XG4gICAgY29uc3Qgc2VsZWN0Qm94ZXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2Ryb3BwYWJsZScpKVxuICAgIGxldCBib3hlc1dpdGhTaGlwcyA9IHNlbGVjdEJveGVzLmZpbHRlcihib3ggPT4ge1xuICAgICAgICBpZiAoYm94Lmhhc0NoaWxkTm9kZXMoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGJveFxuICAgICAgICB9XG4gICAgfSlcbiAgICBsZXQgYm94SUQgPSBib3hlc1dpdGhTaGlwcy5tYXAoYm94ID0+IGJveC5nZXRBdHRyaWJ1dGUoJ3NldC1pZCcpKVxuICAgIGxldCBzaGlwSUQgPSBib3hlc1dpdGhTaGlwcy5tYXAoYm94ID0+IGJveC5maXJzdENoaWxkLmlkKVxuICAgIHJldHVybiB7Ym94SUQsIHNoaXBJRH1cbn1cblxuZnVuY3Rpb24gY2hlY2tQb3NpdGlvbnMoKSB7XG4gICAgY29uc3Qgc2VsZWN0Qm94ZXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2Ryb3BwYWJsZScpKVxuICAgIHNlbGVjdEJveGVzLmZvckVhY2goYm94ID0+IHtcbiAgICAgICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBjaGVjayA9IGdldFBvc2l0aW9ucygpXG4gICAgICAgICAgICBpZiAoY2hlY2suYm94SUQubGVuZ3RoID09IDUpe1xuICAgICAgICAgICAgICAgIGNvbnN0IGJlZ2luQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiZWdpbkJ1dHRvblwiKTtcbiAgICAgICAgICAgICAgICBiZWdpbkJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKVxuICAgICAgICAgICAgfSBcbiAgICAgICAgfSlcbn0pXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNoaXBDb29yZGluYXRlcyhzaGlwLCBib3gpIHtcbiAgICBib3ggPSBOdW1iZXIoYm94KVxuICAgIGlmIChzaGlwID09ICdjYXJyaWVyJykge1xuICAgICAgICBsZXQgY29vcmRpbmF0ZXMgPSBbYm94LCBib3grMSwgYm94KzIsIGJveCszLCBib3grNF1cbiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzXG4gICAgfVxuICAgIGlmIChzaGlwID09ICdiYXR0bGVzaGlwJykge1xuICAgIGxldCBjb29yZGluYXRlcyA9IFtib3gsIGJveCsxLCBib3grMiwgYm94KzNdXG4gICAgICAgIHJldHVybiBjb29yZGluYXRlc1xuICAgIH1cbiAgICBpZiAoc2hpcCA9PSAnY3J1aXNlcicgfHwgc2hpcCA9PSAnc3VibWFyaW5lJykge1xuICAgICAgICBsZXQgY29vcmRpbmF0ZXMgPSBbYm94LCBib3grMSwgYm94KzJdXG4gICAgICAgICAgICByZXR1cm4gY29vcmRpbmF0ZXNcbiAgICB9XG4gICAgaWYgKHNoaXAgPT0gJ2Rlc3Ryb3llcicpIHtcbiAgICAgICAgICAgIGxldCBjb29yZGluYXRlcyA9IFtib3gsIGJveCsxXVxuICAgICAgICAgICAgICAgIHJldHVybiBjb29yZGluYXRlc1xuICAgIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU2hpcHMoYm94ZXMsIHNoaXBzKSB7XG4gICAgbGV0IHNoaXBPbmUgPSBjcmVhdGVTaGlwQ29vcmRpbmF0ZXMoc2hpcHNbMF0sIGJveGVzWzBdKVxuICAgIGxldCBzaGlwVHdvID0gY3JlYXRlU2hpcENvb3JkaW5hdGVzKHNoaXBzWzFdLCBib3hlc1sxXSlcbiAgICBsZXQgc2hpcFRocmVlID0gY3JlYXRlU2hpcENvb3JkaW5hdGVzKHNoaXBzWzJdLCBib3hlc1syXSlcbiAgICBsZXQgc2hpcEZvdXIgPSBjcmVhdGVTaGlwQ29vcmRpbmF0ZXMoc2hpcHNbM10sIGJveGVzWzNdKVxuICAgIGxldCBzaGlwRml2ZSA9IGNyZWF0ZVNoaXBDb29yZGluYXRlcyhzaGlwc1s0XSwgYm94ZXNbNF0pXG4gICAgcmV0dXJuIHtzaGlwT25lLCBzaGlwVHdvLCBzaGlwVGhyZWUsIHNoaXBGb3VyLCBzaGlwRml2ZX1cbn1cblxuZXhwb3J0IHthbGxvd0RyYWcsIGFsbG93RHJvcCwgZ2V0UG9zaXRpb25zLCBjaGVja1Bvc2l0aW9ucywgY3JlYXRlU2hpcHN9IiwiaW1wb3J0IHsgcGxheWVyRmFjdG9yeSB9IGZyb20gXCIuL2ZhY3RvcnlGdW5jdGlvbnNcIjtcbmltcG9ydCB7IHNob3dNZXNzYWdlIH0gZnJvbSBcIi4vZG9tXCI7XG5pbXBvcnQgeyBnZXRSYW5kb21Db29yZGluYXRlcywgY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlcyB9IGZyb20gJy4vY29tcHV0ZXJjb29yZGluYXRlcydcbmltcG9ydCB7IGdldFBvc2l0aW9ucywgY3JlYXRlU2hpcHMgfSBmcm9tICcuL2RyYWdhbmRkcm9wJ1xuXG5sZXQgcGxheWVyT25lID0gcGxheWVyRmFjdG9yeShcInBsYXllck9uZVwiLCBcInBlcnNvblwiKTtcblxuXG5iZWdpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gIGxldCBwb3NpdGlvbnMgPSBnZXRQb3NpdGlvbnMoKVxuICBsZXQgc2hpcHMgPSBjcmVhdGVTaGlwcyhwb3NpdGlvbnMuYm94SUQsIHBvc2l0aW9ucy5zaGlwSUQpXG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY2FycmllclwiLCBzaGlwcy5zaGlwT25lLmxlbmd0aCwgc2hpcHMuc2hpcE9uZSk7XG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwiYmF0dGxlc2hpcFwiLCBzaGlwcy5zaGlwVHdvLmxlbmd0aCwgc2hpcHMuc2hpcFR3byk7XG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwic3VibWFyaW5lXCIsIHNoaXBzLnNoaXBUaHJlZS5sZW5ndGgsIHNoaXBzLnNoaXBUaHJlZSk7XG4gIHBsYXllck9uZS5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY3J1aXNlclwiLCBzaGlwcy5zaGlwRm91ci5sZW5ndGgsIHNoaXBzLnNoaXBGb3VyKTtcbiAgcGxheWVyT25lLmdhbWVCb2FyZC5wbGFjZVNoaXAoXCJkZXN0cm95ZXJcIiwgc2hpcHMuc2hpcEZpdmUubGVuZ3RoLCBzaGlwcy5zaGlwRml2ZSk7XG59KVxuXG5cbmxldCBjb21wdXRlckNvb3JkaW5hdGVzID0gY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlcygpXG5jb25zb2xlLmxvZyhjb21wdXRlckNvb3JkaW5hdGVzKVxubGV0IHBsYXllclR3byA9IHBsYXllckZhY3RvcnkoXCJwbGF5ZXJUd29cIiwgXCJDb21wdXRlclwiKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY2FycmllclwiLCA1LCBjb21wdXRlckNvb3JkaW5hdGVzLmZpcnN0U2hpcENvb3JkaW5hdGVzKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwiYmF0dGxlc2hpcFwiLCA0LCBjb21wdXRlckNvb3JkaW5hdGVzLnNlY29uZFNoaXBDb29yZGluYXRlcyk7XG5wbGF5ZXJUd28uZ2FtZUJvYXJkLnBsYWNlU2hpcChcInN1Ym1hcmluZVwiLCAzLCBjb21wdXRlckNvb3JkaW5hdGVzLnRoaXJkU2hpcENvb3JkaW5hdGVzKTtcbnBsYXllclR3by5nYW1lQm9hcmQucGxhY2VTaGlwKFwiY3J1aXNlclwiLCAzLCBjb21wdXRlckNvb3JkaW5hdGVzLmZvdXJ0aFNoaXBDb29yZGluYXRlcyk7XG5wbGF5ZXJUd28uZ2FtZUJvYXJkLnBsYWNlU2hpcChcImRlc3Ryb3llclwiLCAyLCBjb21wdXRlckNvb3JkaW5hdGVzLmZpcnN0U2hpcENvb3JkaW5hdGVzKTtcblxubGV0IGdhbWVTdGF0dXMgPSBcIlwiO1xuXG5mdW5jdGlvbiBkaXNhYmxlU2VsZkNsaWNrcyhjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pIHtcbiAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyT25lKSB7XG4gICAgYm9hcmRPbmUuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICAgIGJvYXJkVHdvLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImF1dG9cIjtcbiAgfSBlbHNlIGlmIChjdXJyZW50UGxheWVyID09IHBsYXllclR3bykge1xuICAgIGJvYXJkVHdvLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgICBib2FyZE9uZS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJhdXRvXCI7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2FtZU92ZXIob3Bwb3NpbmdQbGF5ZXIpIHtcbiAgbGV0IHJlcG9ydCA9IG9wcG9zaW5nUGxheWVyLmdhbWVCb2FyZC5yZXBvcnQoKTtcbiAgaWYgKHJlcG9ydCA9PSBcIkFsbCBzaGlwcyBoYXZlIHN1bmshXCIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2hlY2tHYW1lU3RhdHVzKGdhbWVTdGF0dXMpIHtcbiAgcmV0dXJuIGdhbWVTdGF0dXM7XG59XG5cbmZ1bmN0aW9uIHBsYXlHYW1lSGVscGVyKGN1cnJlbnRQbGF5ZXIsIG9wcG9zaW5nUGxheWVyLCB0aWxlLCBzcXVhcmUpIHtcbiAgbGV0IGF0dGFjayA9IGN1cnJlbnRQbGF5ZXIuc2VuZEF0dGFjayhvcHBvc2luZ1BsYXllci5nYW1lQm9hcmQsIHNxdWFyZSk7XG4gIGlmIChhdHRhY2sgPT0gXCJub3R2YWxpZFwiKSB7XG4gICAgc2hvd01lc3NhZ2UoXCJUaGF0IG1vdmUgaXMgbm90IHZhbGlkLiBQbGVhc2UgcGljayBhbm90aGVyIHRpbGUuXCIpO1xuICAgIHJldHVybiBcIm5vdHZhbGlkXCI7XG4gIH1cbiAgaWYgKGF0dGFjay5hdHRhY2tTdGF0dXMgPT0gdHJ1ZSkge1xuICAgIHRpbGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJncmVlblwiO1xuICAgIHNob3dNZXNzYWdlKFwiXCIpO1xuICB9IGVsc2UgaWYgKGF0dGFjayA9PSBmYWxzZSkge1xuICAgIHRpbGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICBzaG93TWVzc2FnZShcIlwiKTtcbiAgfVxuICBpZiAoYXR0YWNrLnNoaXBTdGF0dXMgPT0gdHJ1ZSkge1xuICAgIHNob3dNZXNzYWdlKFwiQSBzaGlwIGJlY29tZXMgZmVhc3QgZm9yIHRoZSBmaXNoZXMhXCIpO1xuICB9XG4gIGdhbWVTdGF0dXMgPSBnYW1lT3ZlcihvcHBvc2luZ1BsYXllcik7XG59XG5cbmZ1bmN0aW9uIHBsYXlHYW1lKGN1cnJlbnRQbGF5ZXIsIGJvYXJkT25lLCBib2FyZFR3bykge1xuICBkaXNhYmxlU2VsZkNsaWNrcyhjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pO1xuICBsZXQgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJnYW1lU3F1YXJlXCIpKTtcbiAgY29vcmRpbmF0ZXMuZm9yRWFjaCgodGlsZSkgPT4ge1xuICAgIHRpbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzcXVhcmUgPSB0aWxlLmdldEF0dHJpYnV0ZShcImRhdGEtaWRcIik7XG4gICAgICBpZiAoY3VycmVudFBsYXllciA9PSBwbGF5ZXJPbmUpIHtcbiAgICAgICAgbGV0IG1vdmUgPSBwbGF5R2FtZUhlbHBlcihjdXJyZW50UGxheWVyLCBwbGF5ZXJUd28sIHRpbGUsIHNxdWFyZSk7XG4gICAgICAgIGlmIChtb3ZlICE9IFwibm90dmFsaWRcIikge1xuICAgICAgICAgIGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXJUd287XG4gICAgICAgICAgZGlzYWJsZVNlbGZDbGlja3MoY3VycmVudFBsYXllciwgYm9hcmRPbmUsIGJvYXJkVHdvKTtcbiAgICAgICAgICBwbGF5R2FtZShjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICBpZiAoY3VycmVudFBsYXllciA9PSBwbGF5ZXJUd28pIHtcbiAgICBsZXQgcmFuZG9tU3F1YXJlID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoMCwgOTkpO1xuICAgIGxldCByYW5kb21UaWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtaWQ9XCIke3JhbmRvbVNxdWFyZX1cIl1gKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGxldCBtb3ZlID0gcGxheUdhbWVIZWxwZXIoXG4gICAgICAgIGN1cnJlbnRQbGF5ZXIsXG4gICAgICAgIHBsYXllck9uZSxcbiAgICAgICAgcmFuZG9tVGlsZSxcbiAgICAgICAgcmFuZG9tU3F1YXJlXG4gICAgICApO1xuICAgICAgd2hpbGUgKG1vdmUgPT0gJ25vdHZhbGlkJykge1xuICAgICAgICBsZXQgcmFuZG9tU3F1YXJlID0gZ2V0UmFuZG9tQ29vcmRpbmF0ZXMoMCwgOTkpO1xuICAgICAgICBsZXQgcmFuZG9tVGlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWlkPVwiJHtyYW5kb21TcXVhcmV9XCJdYCk7XG4gICAgICAgIG1vdmUgPSBwbGF5R2FtZUhlbHBlcihcbiAgICAgICAgICBjdXJyZW50UGxheWVyLFxuICAgICAgICAgIHBsYXllck9uZSxcbiAgICAgICAgICByYW5kb21UaWxlLFxuICAgICAgICAgIHJhbmRvbVNxdWFyZSlcbiAgICAgIH1cbiAgICAgIGlmIChtb3ZlICE9IFwibm90dmFsaWRcIikge1xuICAgICAgICBjdXJyZW50UGxheWVyID0gcGxheWVyT25lO1xuICAgICAgICBkaXNhYmxlU2VsZkNsaWNrcyhjdXJyZW50UGxheWVyLCBib2FyZE9uZSwgYm9hcmRUd28pO1xuICAgICAgfVxuICAgIH0sIDcwMCk7XG4gIH1cbn1cblxuZXhwb3J0IHtcbiAgcGxheWVyT25lLFxuICBwbGF5ZXJUd28sXG4gIHBsYXlHYW1lLFxuICBnYW1lT3ZlcixcbiAgY2hlY2tHYW1lU3RhdHVzLFxuICBnYW1lU3RhdHVzLFxufTtcbiIsImltcG9ydCB7XG4gIGNyZWF0ZUdhbWVCb2FyZCxcbiAgc2hvd1NlbGVjdGlvblNjcmVlbixcbiAgc2hvd1NlbGVjdEJvYXJkLFxuICBzaG93R2FtZUJvYXJkLFxuICBhZGRQbGF5ZXJOYW1lLFxuICBuZXdHYW1lLFxuICBzaG93R2FtZU92ZXIsXG59IGZyb20gXCIuL2RvbVwiO1xuaW1wb3J0IHtcbiAgcGxheWVyT25lLFxuICBwbGF5ZXJUd28sXG4gIHBsYXlHYW1lLFxuICBjaGVja0dhbWVTdGF0dXMsXG4gIGdhbWVTdGF0dXMsXG59IGZyb20gXCIuL2dhbWVsb2dpY1wiO1xuaW1wb3J0IHsgYWxsb3dEcmFnLCBhbGxvd0Ryb3AsIGNoZWNrUG9zaXRpb25zIH0gZnJvbSBcIi4vZHJhZ2FuZGRyb3BcIjtcblxuY29uc3QgYm9hcmRPbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkT25lXCIpO1xuY29uc3QgYm9hcmRUd28gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkVHdvXCIpO1xuY29uc3QgcHJlcGFyZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVwYXJlQnV0dG9uJylcbmNvbnN0IGJlZ2luQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiZWdpbkJ1dHRvblwiKTtcbmNvbnN0IHBsYXllck9uZU5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXllck9uZU5hbWVcIik7XG5jb25zdCBuZXdHYW1lQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuZXdHYW1lQnV0dG9uXCIpO1xubGV0IHBsYXllck5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyTmFtZVwiKTtcbmxldCBjdXJyZW50UGxheWVyID0gcGxheWVyT25lO1xuXG5sZXQgcGxheWVyTmFtZSA9IFwiXCI7XG5wbGF5ZXJOYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgcGxheWVyTmFtZSA9IHBsYXllck5hbWVJbnB1dC52YWx1ZTtcbn0pO1xuXG5wcmVwYXJlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIHNob3dTZWxlY3Rpb25TY3JlZW4oKTtcbiAgc2hvd1NlbGVjdEJvYXJkKCk7XG4gIGFsbG93RHJhZygpO1xuICBhbGxvd0Ryb3AoKTtcbiAgY2hlY2tQb3NpdGlvbnMoKTtcbn0pO1xuXG5iZWdpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBzaG93R2FtZUJvYXJkKCk7XG4gIGFkZFBsYXllck5hbWUocGxheWVyT25lTmFtZSwgcGxheWVyTmFtZSk7XG4gIGNyZWF0ZUdhbWVCb2FyZChwbGF5ZXJPbmUsIGJvYXJkT25lKTtcbiAgY3JlYXRlR2FtZUJvYXJkKHBsYXllclR3bywgYm9hcmRUd28pO1xufSlcblxuYmVnaW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgcGxheUdhbWUoY3VycmVudFBsYXllciwgYm9hcmRPbmUsIGJvYXJkVHdvKTtcbiAgbGV0IGNvb3JkaW5hdGVzID0gQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZ2FtZVNxdWFyZVwiKSk7XG4gIGNvb3JkaW5hdGVzLmZvckVhY2goKHRpbGUpID0+IHtcbiAgICB0aWxlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoY2hlY2tHYW1lU3RhdHVzKGdhbWVTdGF0dXMpID09IHRydWUpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIgPT0gcGxheWVyT25lKSB7XG4gICAgICAgICAgc2hvd0dhbWVPdmVyKHBsYXllck9uZU5hbWUudGV4dENvbnRlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNob3dHYW1lT3ZlcihcIkNvbXB1dGVyXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmNvbnN0IGdhbWVPdmVyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWVPdmVyQnV0dG9uJylcblxuZ2FtZU92ZXJCdXR0b24ub25jbGljayA9IHNob3dHYW1lT3ZlclxuXG5uZXdHYW1lQnV0dG9uLm9uY2xpY2sgPSBuZXdHYW1lO1xuIl0sIm5hbWVzIjpbImNyZWF0ZUdhbWVCb2FyZCIsInBsYXllciIsImJvYXJkIiwiaSIsImdhbWVCb2FyZCIsImxlbmd0aCIsImdhbWVTcXVhcmUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJwbGF5ZXJOYW1lIiwic2V0QXR0cmlidXRlIiwiYXBwZW5kQ2hpbGQiLCJuZXdHYW1lIiwibG9jYXRpb24iLCJyZWxvYWQiLCJzaG93R2FtZU92ZXIiLCJjdXJyZW50UGxheWVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJnYW1lT3ZlckNvbnRhaW5lciIsInJlbW92ZSIsImRpc3BsYXlXaW5uZXJUZXh0IiwiaW5uZXJUZXh0IiwibmV3R2FtZUJ1dHRvbiIsInRleHRDb250ZW50Iiwib25jbGljayIsInNob3dNZXNzYWdlIiwibWVzc2FnZSIsImdhbWVCb2FyZEZhY3RvcnkiLCJtaXNzZWRBdHRhY2tzIiwic3VjY2Vzc2Z1bEF0dGFja3MiLCJzdW5rU2hpcHMiLCJwbGFjZVNoaXAiLCJuYW1lT2ZTaGlwIiwiY29vcmRpbmF0ZXMiLCJuZXdTaGlwIiwid2hlcmVIaXQiLCJoaXQiLCJudW1iZXIiLCJwYXJzZUludCIsImluY2x1ZGVzIiwicHVzaCIsImlzU3VuayIsInN1bmtTdGF0dXMiLCJ0aGlzIiwic2hpcEZhY3RvcnkiLCJmb3JFYWNoIiwiY29vcmRpbmF0ZSIsInJlY2VpdmVBdHRhY2siLCJhdHRhY2tTdGF0dXMiLCJzaGlwU3RhdHVzIiwicmVwb3J0IiwibWFwIiwidGlsZSIsInBsYXllckZhY3RvcnkiLCJwbGF5ZXJUeXBlIiwic2VuZEF0dGFjayIsInVuZGVmaW5lZCIsImdldFJhbmRvbUNvb3JkaW5hdGVzIiwibWluIiwibWF4IiwiTWF0aCIsImNlaWwiLCJmbG9vciIsInJhbmRvbSIsImRyYWdnYWJsZVNoaXBzIiwiQXJyYXkiLCJmcm9tIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImFjdGl2YXRlRHJvcCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJzaG93SG92ZXJDb2xvciIsInRhcmdldCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwicmVtb3ZlSG92ZXJDb2xvciIsImRyYWciLCJlIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImdldEF0dHJpYnV0ZSIsImRyb3AiLCJkYXRhIiwiZ2V0RGF0YSIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRQb3NpdGlvbnMiLCJib3hlc1dpdGhTaGlwcyIsImZpbHRlciIsImJveCIsImhhc0NoaWxkTm9kZXMiLCJib3hJRCIsInNoaXBJRCIsImZpcnN0Q2hpbGQiLCJpZCIsImNyZWF0ZVNoaXBDb29yZGluYXRlcyIsInNoaXAiLCJOdW1iZXIiLCJwbGF5ZXJPbmUiLCJiZWdpbkJ1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJwb3NpdGlvbnMiLCJzaGlwcyIsImJveGVzIiwic2hpcE9uZSIsInNoaXBUd28iLCJzaGlwVGhyZWUiLCJzaGlwRm91ciIsInNoaXBGaXZlIiwiY3JlYXRlU2hpcHMiLCJjb21wdXRlckNvb3JkaW5hdGVzIiwiZmlyc3RTaGlwRmlyc3RQb3NpdGlvbiIsInRvU3RyaW5nIiwiZmlyc3RTaGlwQ29vcmRpbmF0ZXMiLCJzZWNvbmRTaGlwRmlyc3RQb3NpdGlvbiIsInNlY29uZFNoaXBDb29yZGluYXRlcyIsInRoaXJkU2hpcEZpcnN0UG9zaXRpb24iLCJ0aGlyZFNoaXBDb29yZGluYXRlcyIsImZvdXJ0aFNoaXBGaXJzdFBvc2l0aW9uIiwiZm91cnRoU2hpcENvb3JkaW5hdGVzIiwiZmlmdGhTaGlwRmlyc3RQb3NpdGlvbiIsImZpZnRoU2hpcENvb3JkaW5hdGVzIiwiY3JlYXRlQ29tcHV0ZXJDb29yZGluYXRlcyIsImNvbnNvbGUiLCJsb2ciLCJwbGF5ZXJUd28iLCJnYW1lU3RhdHVzIiwiZGlzYWJsZVNlbGZDbGlja3MiLCJib2FyZE9uZSIsImJvYXJkVHdvIiwicG9pbnRlckV2ZW50cyIsInBsYXlHYW1lSGVscGVyIiwib3Bwb3NpbmdQbGF5ZXIiLCJzcXVhcmUiLCJhdHRhY2siLCJnYW1lT3ZlciIsInBsYXlHYW1lIiwicmFuZG9tU3F1YXJlIiwicmFuZG9tVGlsZSIsInNldFRpbWVvdXQiLCJtb3ZlIiwicHJlcGFyZUJ1dHRvbiIsInBsYXllck9uZU5hbWUiLCJwbGF5ZXJOYW1lSW5wdXQiLCJ2YWx1ZSIsInNlbGVjdEJvYXJkIiwic2hvd1NlbGVjdEJvYXJkIiwiYWRkUGxheWVyTmFtZSJdLCJzb3VyY2VSb290IjoiIn0=